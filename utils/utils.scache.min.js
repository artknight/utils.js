if(!UTILS)var UTILS={};UTILS.SCache=class{constructor(data={}){return this.values={},this.values=this._extend(this.getDefaults(),data),this.log(this.getObjectName()+" --\x3e instantiated"),"overlay"in data&&this.setOverlayOptions(data.overlay),"scripts"in data&&this.addScripts(data.scripts),this.createOnAllScriptsLoadedPromise()}getDefaults(){return{object:"utils.scache",version:"0.5.8",id:0,name:"",fns:{},LAB:$LAB,loaded_scripts:[],overlay:{hide:!0},all_scripts_loaded_promise:null,show_log:"function"==typeof APP.showLog?APP.showLog():null,show_timer:"function"==typeof APP.showTimer&&APP.showTimer()}}getObjectName(){return this.values.object+" v"+this.values.version}getObjectVersion(){return this.values.version}log(...args){return this.values.show_log&&console.log(args),this}_extend(scope1,scope2){const keys=Object.keys(scope2);for(var key,i=0;key=keys[i];i++)scope1[key]=scope2[key];return scope1}createOnAllScriptsLoadedPromise(){var _resolve,_reject,promise=new Promise(function(resolve,reject){_resolve=resolve,_reject=reject});return promise.resolve=_resolve,promise.reject=_reject,promise.scache=this,this.values.all_scripts_loaded_promise=promise,promise}getOnAllScriptsLoadedPromise(){return this.values.all_scripts_loaded_promise}getOverlayOptions(){return this.values.overlay}setOverlayOptions(options){return this.values.overlay=this._extend(this.values.overlay,options),this}hideOverlay(force_hide){if(this.getOverlayOptions().hide||force_hide){var overlay=document.getElementById("body-overlay"),overlay_msg=document.getElementById("body-overlay-msg");if(overlay||overlay_msg)try{overlay.parentNode.removeChild(overlay),overlay_msg.parentNode.removeChild(overlay_msg)}catch(e){}}return this}showOverlay(){var overlay=document.getElementById("body-overlay"),overlay_msg=document.getElementById("body-overlay-msg");if(!overlay&&!overlay_msg){overlay=document.createElement("div"),overlay_msg=document.createElement("div");var spinner=document.createElement("div"),msg=document.createElement("div");overlay.id="body-overlay",overlay.setAttribute("class","body-overlay"),overlay_msg.id="body-overlay-msg",overlay_msg.setAttribute("class","body-overlay-msg"),spinner.setAttribute("class","sp sp-circle"),msg.innerHTML="Loading resources, please wait...",overlay_msg.appendChild(spinner),overlay_msg.appendChild(msg);var body=document.getElementsByTagName("body")[0];body&&(body.appendChild(overlay),body.appendChild(overlay_msg))}return this}addToCache(script){const _onSuccess=function(response){this.log(this.getObjectName()+" --\x3e added to cache",script.script_url);try{localStorage.setItem(script.base_url,JSON.stringify({content:this.compress(response),url:script.script_url,id:script.id}))}catch(e){this.log(this.getObjectName()+" --\x3e error or local storage limit reached",e)}}.bind(this);var script_url=this._getFilteredUrl(script.script_url);return/^http/i.test(script_url)&&(script_url="https://cors-anywhere.herokuapp.com/"+script_url),/\^nocache=/i.test(script.script_url)||axios.get(script_url,{headers:{"X-Requested-With":"XMLHttpRequest"}}).then(response=>response.data).then(_onSuccess).catch(),this.values.show_timer&&console.timeEnd(script.timer_id),script.promise_tuple.resolve(),this}_getFilteredUrl(script_url){return script_url.replace(/(\?|&)\^type=(js|css)/g,"$1").replace(/(\?|&)\^nocache=(true|false)/g,"$1").replace(/(&&)+/g,"&").replace(/(\?&)+/g,"?").replace(/(\?|&)+$/g,"")}getBaseUrl(script_url){return script_url.split("?")[0]}isJS(script_url){return/\.js/i.test(script_url)}addToPage(script){var $head=document.getElementsByTagName("head")[0],$title=document.getElementsByTagName("title")[0],$insert_before_elm=script.is_js?$head.firstChild:$title;return this.log(this.getObjectName()+" --\x3e added to HEAD",this._getFilteredUrl(script.script_url)),$head.insertBefore(script.$script,$insert_before_elm),this}loadFromCache(script){if(script.ls_item.url!==script.script_url){this.log(this.getObjectName()+" --\x3e script url changed, removing",script.ls_item.url),localStorage.removeItem(script.base_url);var existing_script=document.getElementById(script.id);existing_script&&existing_script.parentNode.removeChild(existing_script),this[script.is_js?"loadJS":"loadCSS"](script)}else this.log(this.getObjectName()+" --\x3e loading script from cache",script.ls_item.url),document.getElementById(script.id)||(script.$script=this.getScriptElm(script),script.$script.appendChild(document.createTextNode(this.decompress(script.ls_item.content))),script.$script.appendChild(document.createTextNode(this.getSourceUrlMapName(script))),this.addToPage(script)),this.values.show_timer&&console.timeEnd(script.timer_id),script.promise_tuple.resolve();return this}loadJS(script){script.$script=this.getScriptElm(script);var script_url=this._getFilteredUrl(script.script_url);return this.values.LAB=this.values.LAB.script({src:script_url,id:script.id}).wait(this.addToCache.bind(this,script)),this}loadCSS(script){script.$script=document.createElement("link"),script.$script.setAttribute("rel","stylesheet"),script.$script.setAttribute("type","text/css"),script.$script.setAttribute("href",script.script_url),script.$script.setAttribute("id",script.id),this.addToPage(script);var img=document.createElement("img");return img.onerror=this.addToCache.bind(this,script),img.src=script.script_url,this}getScriptElm(script){var $script=document.createElement(script.is_js?"script":"style");return $script.setAttribute("type",script.is_js?"text/javascript":"text/css"),$script.setAttribute("id",script.id),$script}compress(content){return LZString.compressToBase64(content)}decompress(content){return LZString.decompressFromBase64(content)}getSourceUrlMapName(script){var script_id=script.ls_item.id,ext=script.is_js?".js":".css",wrapper=script.is_js?"//{url}":"/*{url}*/",url="# sourceURL="+(/\.(js|css)$/i.test(script_id)?script_id:script_id+""+ext);return wrapper.replace(/\{url\}/g,url)}_onAllScriptsLoaded(){this.log(this.getObjectName()+" --\x3e all scripts loaded"),this.hideOverlay(),this.getOnAllScriptsLoadedPromise().resolve()}_onScriptsLoadError(response){this.log(this.getObjectName()+" --\x3e scripts failed to load",response),this.hideOverlay(),this.getOnAllScriptsLoadedPromise().reject(response)}createScriptId(script){return script.base_url.split("/").slice(-1)[0]}loadScript(script){return this.values.loaded_scripts.push(script),script.ls_item?(script.ls_item=JSON.parse(script.ls_item),script.id=script.ls_item.id,this.loadFromCache(script)):(script.id=this.createScriptId(script),this[script.is_js?"loadJS":"loadCSS"](script)),this}addScripts(script_urls=[]){for(var script_url,object_name=this.getObjectName(),promises=[],i=0;script_url=script_urls[i];i++){var base_url=this.getBaseUrl(script_url),script={id:null,timer_id:object_name+" --\x3e "+base_url+" ("+(65536*(1+Math.random())|0).toString(16)+")",script_url:script_url,base_url:base_url,ls_item:localStorage.getItem(base_url),is_js:this.isJS(base_url),promise_tuple:{resolve:null,reject:null}};/\^type=js/i.test(script_url)&&(script.is_js=!0),this.values.loaded_scripts.find(s=>s.base_url.includes(script.base_url))?this.log(this.getObjectName()+" --\x3e dupplicate script found",script.script_url):promises.push(new Promise(function(resolve,reject){script.promise_tuple={resolve:resolve,reject:reject},this.values.show_timer&&console.time(script.timer_id),this.loadScript(script)}.bind(this)))}return promises.length?(this.showOverlay(),Promise.all(promises).then(this._onAllScriptsLoaded.bind(this),this._onScriptsLoadError.bind(this))):this._onAllScriptsLoaded(),this}};