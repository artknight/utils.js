UTILS.Daterange=class extends UTILS.Base{constructor(data={}){if(super(data),"target"in data)return"range"in data&&this.setDateRange(data.range),"start"in data&&this.setStart(data.start),"end"in data&&this.setEnd(data.end),"container"in data&&this.setContainer(data.container),"value"in data&&this.setInitialTargetValue(data.value),"onShow"in data&&this.addCallback("onShow",data.onShow),"onShown"in data&&this.addCallback("onShown",data.onShown),"onHide"in data&&this.addCallback("onHide",data.onHide),"onHidden"in data&&this.addCallback("onHidden",data.onHidden),"onStartSelected"in data&&this.addCallback("onStartSelected",data.onStartSelected),"onEndSelected"in data&&this.addCallback("onEndSelected",data.onEndSelected),"onApply"in data&&this.addCallback("onApply",data.onApply),"onDateChanged"in data&&this.addCallback("onDateChanged",data.onDateChanged),this._init(),"auto_close"in data&&(this.values.auto_close=data.auto_close),this;throw new Error("@target must be specified upon initialization!")}getDefaults(){return{object:"utils.daterange",version:"0.0.4",date_format:"MM/DD/YYYY",$elm:null,auto_close:!1,separator:" - ",language:"en",start_of_week:"sunday",start_date:!1,end_date:!1,time:{enabled:!1},min_days:0,max_days:0,min_months:0,max_months:0,min_years:0,max_years:0,show_shortcuts:!1,shortcuts:[],$container:$("body"),single_date:!1,look_behind:!1,batch_mode:!1,duration:200,sticky:!1,day_div_attributes:[],day_td_attributes:[],select_forward:!1,select_backward:!1,single_month:$(window).width()<480,show_topbar:!1,swap_time:!1,show_week_numbers:!1,min_view_mode:"days",view:{month1:"days",month2:"days"},start:!1,end:!1,start_week:!1,is_activated:!1,show_tooltip:!0,is_editable_usage:!1}}_init(){return this.isMobile()&&(this.values.show_tooltip=!1),this.values.single_month&&(this.values.sticky=!1),this.isShowTopbar()||(this.values.auto_close=!0),this._create().then($elm=>{let date_format=this.getDateFormat(),$target=this.getTarget();this.enableControls(),this.values.start_date&&"string"==typeof this.values.start_date&&(this.values.start_date=moment(this.values.start_date,date_format).toDate()),this.values.end_date&&"string"==typeof this.values.end_date&&(this.values.end_date=moment(this.values.end_date,date_format).toDate()),this.calcPosition();var defaultEndTime,default_date=this.getDefaultDate();this.resetMonthsView(default_date),this.values.time.enabled&&(this.values.start_date&&this.values.end_date||this.getStart()&&this.getEnd()?(this.showTime(moment(this.getStart()||this.values.start_date).toDate(),"time1"),this.showTime(moment(this.getEnd()||this.values.end_date).toDate(),"time2")):(defaultEndTime=this.values.defaultEndTime||default_date,this.showTime(default_date,"time1"),this.showTime(defaultEndTime,"time2"))),this.values.single_month?$elm.addClass("single-month"):$elm.addClass("two-months"),setTimeout(()=>{this.updateCalendarWidth(),this.setActivated(!0)},0),$elm.on("click",event=>event.stopPropagation()),$(document).on("click.utils.daterange",this.outsideClickClose.bind(this)),$elm.find(".next").on("click",this.goNext.bind(this)),$elm.find(".prev").on("click",this.goPrev.bind(this)),$elm.find(".caption-title").on("click",event=>{var event=$(event.currentTarget).closest("table"),month=event.hasClass("month2")?"month2":"month1",curr_date=this.values[month];/^days$/i.test(this.values.view[month])?this.values.view[month]="months":/^months$/i.test(this.values.view[month])&&(this.values.view[month]="years"),event.attr("data-view",this.values.view[month]),this.renderCalendar(curr_date,month)}),$elm.find(".month-wrapper table").on("click",".cell",this.onDateChanged.bind(this)),$elm.find(".month-wrapper table").on("mouseenter",".cell",this.onCellHover.bind(this)),$elm.find(".month-wrapper table").on("mouseleave",".cell",event=>{$elm.find(".date-range-length-tip").remove(),this.isSingleDate()&&this.clearOnCellHover()}),$elm.find(".month-wrapper table").on("click",".week-number",this.weekNumberClicked.bind(this)),$elm.attr("unselectable","on").css("user-select","none").on("selectstart",event=>(event.preventDefault(),!1)),$elm.find(".apply-btn").on("click",event=>{this.hide(),this.triggerApply()}),$elm.find(".shortcuts").on("click",".shortcut",event=>{event.preventDefault();let $shortcut=$(event.currentTarget),shortcut=$shortcut.data("shortcut"),range="method"in shortcut?{...shortcut.method(this)}:{start:null,end:null},is_autoclose=this.isAutoClose();this.isDate(range.start)&&this.isDate(range.end)?(this.setDateRange(range.start,range.end),this.validateSelection()):!this.values.show_shortcuts||this.isDate(range.start)&&this.isDate(range.end)?this.isDate(range.start)&&(this.renderCalendar(range.start,"month1"),this.renderCalendar(this.nextMonth(range.start),"month2"),this.showDivider()):($elm.find(".cell.checked").removeClass("checked"),"start"in range&&"end"in range?this.triggerApply(range):(_.isString(range)||(range=_.toArray(range).join("")),this.setTargetValue(range)),this.setStart(null),this.setEnd(null),this.validateSelection(),this.updateSelectionInHeader(!0),this.showSelectedDates(),this.fns("onEndSelected"),is_autoclose&&this.hide())}),$elm.find(".time1 input[type=range]").on("input change touchmove",event=>{var event=event.currentTarget,hour="hour"==event.name?$(event).val().replace(/^(\d{1})$/,"0$1"):void 0,event="minute"==event.name?$(event).val().replace(/^(\d{1})$/,"0$1"):void 0;this.setTime("time1",hour,event)}),$elm.find(".time2 input[type=range]").on("input change touchmove",event=>{var event=event.currentTarget,hour="hour"==event.name?$(event).val().replace(/^(\d{1})$/,"0$1"):void 0,event="minute"==event.name?$(event).val().replace(/^(\d{1})$/,"0$1"):void 0;this.setTime("time2",hour,event)}),$target.data("utils.daterange-opened")?this.hide():$target.data("utils.daterange-opened",!0)}),this}isMobile(){return!!("ontouchstart"in window||navigator.msMaxTouchPoints)}isActivated(){return this.values.is_activated}setActivated(state){return this.values.is_activated=!!state,this}enable(){return this.enableControls()}disable(){return this.disableControls()}getStartOfWeek(){return this.values.start_of_week}enableControls(){let $target=this.getTarget(),$elm=this.getElm();return $target.addClass("utils-daterange").off(".utils.daterange").on("click.utils.daterange",event=>{$elm.is(":visible")||this.show(this.values.duration)}).on("change.utils.daterange",this.checkAndSetDefaultValue.bind(this)).on("keyup.utils.daterange",event=>{try{clearTimeout(this.values.dom_change_timer)}catch(e){}this.values.dom_change_timer=setTimeout(this.checkAndSetDefaultValue.bind(this),2e3)}),$(window).on("resize.utils.daterange",this.calcPosition.bind(this)),this}disableControls(){let $target=this.getTarget(),$elm=this.getElm();return $target.removeClass("utils-daterange").off(".utils.daterange").removeData("dateRangePicker").removeData("utils.daterange-opened"),$elm.remove(),$(window).off("resize.utils.daterange",this.calcPosition.bind(this)),$(document).off("click.utils.daterange",this.outsideClickClose.bind(this)),this}clean(){return this.disableControls(),this.values.$elm.remove(),this}isShowTopbar(){return this.values.show_topbar}_create(){return new Promise((resolve,reject)=>{if(this.values.$elm)resolve(this.values.$elm);else{var $container=this.getContainer(),is_show_topbar=this.isShowTopbar(),is_autoclose=this.isAutoClose(),is_single_date=this.isSingleDate(),wrapper_class=[];this.values.extra_class&&wrapper_class.push(this.values.extra_class),is_single_date&&wrapper_class.push("single-date"),this.values.show_shortcuts||wrapper_class.push("no-shortcuts"),is_show_topbar||wrapper_class.push("no-topbar"),this.values.custom_topbar&&wrapper_class.push("custom-topbar"),this.values.$elm=$(`<div class="date-picker-wrapper date-picker-wrapper-orient-left date-picker-wrapper-orient-bottom ${wrapper_class.join(" ")}" data-min-view-mode="${this.values.min_view_mode}"></div>`).hide();let $topbar=null;if(is_show_topbar){if($topbar=$('<div class="drp_top-bar"></div>'),this.values.custom_topbar)"function"==typeof this.values.custom_topbar&&(this.values.custom_topbar=this.values.custom_topbar()),$topbar.append('<div class="custom-top">'+this.values.custom_topbar+"</div>");else{let $normal_top=$('<div class="normal-top"><span class="selection-top">'+this.translate("selected")+' </span><b class="start-day">...</b></div>');is_single_date||$normal_top.append('<span class="separator-day">'+this.values.separator+'</span> <b class="end-day">...</b> <i class="selected-days">(<span class="selected-days-num">3</span> '+this.translate("days")+")</i>"),$topbar.append($normal_top)}$topbar.append('<button class="apply-btn btn btn-primary  disabled '+(is_autoclose?"hide":"")+'">'+this.translate("apply")+"</button>")}let _colspan=this.values.show_week_numbers?6:5,$month_wrapper=$(`<div class="month-wrapper ${is_single_date?"is-single-date":""}" data-sticky="${this.values.sticky?"yes":"no"}"></div>`),$month1=$(`<table class="month1" cellspacing="0" border="0" cellpadding="0" data-view="${this.values.min_view_mode}">
									<thead>
										<tr class="caption">
											<th><span class="prev"></span></th>
											<th colspan="${_colspan}" class="month-name"><span class="caption-title"></span></th>
											<th><span class="next"></span></th>
										</tr>
										<tr class="week-name">${this.getWeekHead()}</tr>
									</thead>
									<tbody></tbody>
								</table>`),$month2=null,$time=(this.hasMonth2()&&($month2=$(`<div class="gap">${this.getGapHTML()}</div>
									<table class="month2" cellspacing="0" border="0" cellpadding="0" data-view="${this.values.min_view_mode}">
										<thead>
											<tr class="caption">
												<th><span class="prev"></span></th>
												<th colspan="${_colspan}" class="month-name"><span class="caption-title"></span></th>
												<th><span class="next"></span></th>
											</tr>
											<tr class="week-name">${this.getWeekHead()}</tr>
										</thead>
										<tbody></tbody>
									</table>`)),$month_wrapper.append([$month1,$month2]),$(`<div class="time ${this.values.time.enabled?"":"hide"}"><div class="time1"></div></div>`)),$footer=(is_single_date||$time.append('<div class="time2"></div>'),$('<div class="footer"></div>'));if(this.values.show_shortcuts){let $shortcuts=$('<div class="shortcuts"><b>'+this.translate("shortcuts")+"</b></div>"),shortcuts=[];_.each(this.values.shortcuts,shortcut=>{var $shortcut=$('<a class="shortcut" href="#">'+shortcut.name+"</a>").data("shortcut",shortcut);"css"in shortcut&&$shortcut.addClass(shortcut.css),shortcuts.push($shortcut)}),$footer.append($shortcuts.append(shortcuts))}this.values.$elm.append([$topbar,$month_wrapper,$time,$footer]),this.values.$elm.data("$daterange",this),$container.append(this.values.$elm),resolve(this.values.$elm)}})}getDateFormat(){return this.values.date_format}setDateFormat(format){return this.values.date_format=format,this}setStart(date){return this.isDate(date)&&(date=(_.isString(date)?moment(date,this.getDateFormat()):moment(date)).valueOf()),this.values.start=date,this}setEnd(date){return this.isDate(date)&&(date=(_.isString(date)?moment(date,this.getDateFormat()):moment(date)).valueOf()),this.values.end=date,this}getStart(){return this.values.start}getEnd(){return this.values.end}getContainer(){return this.values.$container}setContainer(container){return this.values.$container=container instanceof UTILS.Box?container.getMainbody():$(container),this}getTargetValue(){var $target=this.getTarget();return $target.is(":input")?$target.val():$target.text()}setTargetValue(value){let $target=this.getTarget(),method=$target.is(":input")?"val":"text",old_value=$target[method]();return $target.attr("readonly")||$target.is(":disabled")||value==old_value||$target[method](value),this}hoveringTooltip(days){return 1<days?days+" "+this.translate(this.values.min_view_mode):""}getWeekNumber(date){return moment(date).format("w")}isOwnDatePickerClicked(event,target){return target.contains(event.target)||event.target==target||null!=target.childNodes&&0<=$.inArray(event.target,target.childNodes)}goNext(event){let{month,view}=this.getEventData(event),curr_date=this.values[month],is_single_date=this.isSingleDate();switch(view){case"days":if(this.values.sticky){let date1=this.nextMonth(this.values.month1),date2=this.nextMonth(this.values.month2);if(1<moment(this.values.month2).diff(moment(this.values.month1,"month"))&&(/month1/.test(month)?date2=this.nextMonth(date1):date1=this.prevMonth(date2)),this.isDateOutOfBounds(date2)||!is_single_date&&0<=this.compareMonth(date1,date2))return;this.renderCalendar(date1,"month1"),this.renderCalendar(date2,"month2"),this.showSelectedDates()}else{if(curr_date=this.nextMonth(curr_date),!this.values.single_month&&!is_single_date&&!/month2/.test(month)&&0<=this.compareMonth(curr_date,this.values.month2)||this.isDateOutOfBounds(curr_date))return;this.renderCalendar(curr_date,month)}break;case"months":if(this.values.sticky){let date1=this.nextYear(this.values.month1),date2=this.nextYear(this.values.month2);if(1<moment(this.values.month2).diff(moment(this.values.month1,"year"))&&(/month1/.test(month)?date2=this.nextYear(date1):date1=this.prevYear(date2)),this.isDateOutOfBounds(date2)||!is_single_date&&0<=this.compareYear(date1,date2))return;this.renderCalendar(date1,"month1"),this.renderCalendar(date2,"month2"),this.showSelectedDates()}else{if(curr_date=this.nextYear(curr_date),!this.values.single_month&&!is_single_date&&!/month2/.test(month)&&0<=this.compareYear(curr_date,this.values.month2)||this.isDateOutOfBounds(curr_date))return;this.renderCalendar(curr_date,month),this.showDivider()}break;case"years":if(this.values.sticky){let date1=this.nextDecade(this.values.month1),date2=this.nextDecade(this.values.month2);if(10<moment(this.values.month2).diff(moment(this.values.month1,"year"))&&(/month1/.test(month)?date2=this.nextDecade(date1):date1=this.prevDecade(date2)),this.isDateOutOfBounds(date1)||!is_single_date&&this.compareYear(date2,date1)<=0)return;this.renderCalendar(date2,"month2"),this.renderCalendar(date1,"month1"),this.showSelectedDates()}else{if(curr_date=this.nextDecade(curr_date),/month2/.test(month)&&this.compareDecade(curr_date,this.values.month1)<=0||this.isDateOutOfBounds(curr_date))return;this.renderCalendar(curr_date,month)}}return this.showDivider(),this}goPrev(event){let{month,view}=this.getEventData(event),curr_date=this.values[month],is_single_date=this.isSingleDate();switch(view){case"days":if(this.values.sticky){let date1=this.prevMonth(this.values.month1),date2=this.prevMonth(this.values.month2);if(1<moment(this.values.month2).diff(moment(this.values.month1,"month"))&&(/month1/.test(month)?date2=this.nextMonth(date1):date1=this.prevMonth(date2)),this.isDateOutOfBounds(date1)||!is_single_date&&this.compareMonth(date2,date1)<=0)return;this.renderCalendar(date2,"month2"),this.renderCalendar(date1,"month1"),this.showSelectedDates()}else{if(curr_date=this.prevMonth(curr_date),/month2/.test(month)&&this.compareMonth(curr_date,this.values.month1)<=0||this.isDateOutOfBounds(curr_date))return;this.renderCalendar(curr_date,month)}break;case"months":if(this.values.sticky){let date1=this.prevYear(this.values.month1),date2=this.prevYear(this.values.month2);if(1<moment(this.values.month2).diff(moment(this.values.month1,"year"))&&(/month1/.test(month)?date2=this.nextYear(date1):date1=this.prevYear(date2)),this.isDateOutOfBounds(date1)||!is_single_date&&this.compareYear(date2,date1)<=0)return;this.renderCalendar(date2,"month2"),this.renderCalendar(date1,"month1"),this.showSelectedDates()}else{if(curr_date=this.prevYear(curr_date),/month2/.test(month)&&this.compareYear(curr_date,this.values.month1)<=0||this.isDateOutOfBounds(curr_date))return;this.renderCalendar(curr_date,month)}break;case"years":if(this.values.sticky){let date1=this.prevDecade(this.values.month1),date2=this.prevDecade(this.values.month2);if(10<moment(this.values.month2).diff(moment(this.values.month1,"year"))&&(/month1/.test(month)?date2=this.nextDecade(date1):date1=this.prevDecade(date2)),this.isDateOutOfBounds(date1)||!is_single_date&&this.compareYear(date2,date1)<=0)return;this.renderCalendar(date2,"month2"),this.renderCalendar(date1,"month1"),this.showSelectedDates()}else{if(curr_date=this.prevDecade(curr_date),/month2/.test(month)&&this.compareDecade(curr_date,this.values.month1)<=0||this.isDateOutOfBounds(curr_date))return;this.renderCalendar(curr_date,month)}}return this.showDivider(),this}calcPosition(){var leftIndent,$elm=this.getElm(),$target=this.getTarget(),$container=this.getContainer(),offset=$target.offset();return"relative"===$container.css("position")?($container=$container.offset(),leftIndent=Math.max(0,offset.left+$elm.outerWidth()-$("body").width()+16),$elm.css({top:offset.top-$container.top+$target.outerHeight()+4,left:offset.left-$container.left-leftIndent})):offset.left<460?$elm.css({top:offset.top+$target.outerHeight()+parseInt($("body").css("border-top")||0,10),left:offset.left}):$elm.css({top:offset.top+$target.outerHeight()+parseInt($("body").css("border-top")||0,10),left:offset.left+$target.width()-$elm.width()-16}),this}getElm(){return this.values.$elm}show(){this.getTarget();let $elm=this.getElm();return this.redrawDatePicker(),this.checkAndSetDefaultValue(),this.fns("onShow"),$elm.fadeIn(300,()=>{this.fns("onShown")}),this.showDivider(),this.updateCalendarWidth(),this.calcPosition(),this}hide(){var $elm=this.getElm(),$target=this.getTarget();return this.fns("onHide"),$elm.fadeOut(this.values.duration,()=>{this.fns("onHidden"),$target.data("utils.daterange-opened",!1)}),this}setInitialTargetValue(value){let dates=value?value.split(this.values.separator):"",date_format=this.getDateFormat(),is_single_date=this.isSingleDate(),dates_as_string="";return dates&&(1===dates.length&&is_single_date||2<=dates.length)&&(date_format.match(/Do/)&&(date_format=date_format.replace(/Do/,"D"),dates[0]=dates[0].replace(/(\d+)(th|nd|st)/,"$1"),2<=dates.length&&(dates[1]=dates[1].replace(/(\d+)(th|nd|st)/,"$1"))),2<=dates.length?dates_as_string=this.getDateString(new Date(this.getValidValue(dates[0],date_format,moment.locale(this.values.language))))+this.values.separator+this.getDateString(new Date(this.getValidValue(dates[1],date_format,moment.locale(this.values.language)))):1===dates.length&&is_single_date&&(dates_as_string=this.getDateString(new Date(this.getValidValue(dates[0],date_format,moment.locale(this.values.language))))),this.setTargetValue(dates_as_string)),this}checkAndSetDefaultValue(){let target_value=this.getTargetValue(),defaults=target_value?target_value.split(this.values.separator):"",date_format=this.getDateFormat(),is_single_date=this.isSingleDate();return defaults&&(1==defaults.length&&is_single_date||2<=defaults.length)&&(date_format.match(/Do/)&&(date_format=date_format.replace(/Do/,"D"),defaults[0]=defaults[0].replace(/(\d+)(th|nd|st)/,"$1"),2<=defaults.length&&(defaults[1]=defaults[1].replace(/(\d+)(th|nd|st)/,"$1"))),this.setActivated(!1),2<=defaults.length?this.setDateRange(this.getValidValue(defaults[0],date_format,moment.locale(this.values.language)),this.getValidValue(defaults[1],date_format,moment.locale(this.values.language))):1===defaults.length&&is_single_date&&this.setSingleDate(this.getValidValue(defaults[0],date_format,moment.locale(this.values.language))),this.setActivated(!0)),this}getValidValue(date,format,locale){return(moment(date,format,locale).isValid()?moment(date,format,locale):moment()).toDate()}updateCalendarWidth(){var $elm=this.getElm(),gapMargin=(gapMargin=$elm.find(".gap").css("margin-left"))&&parseInt(gapMargin),w1=$elm.find(".month1").width(),gapMargin=$elm.find(".gap").width()+(gapMargin?2*gapMargin:0),w3=$elm.find(".month2").width();return $elm.find(".month-wrapper").width(w1+gapMargin+w3),this}renderTime(name,date){let $elm=this.getElm();return $elm.find("."+name+" input[type=range].hour-range").val(moment(date).hours()),$elm.find("."+name+" input[type=range].minute-range").val(moment(date).minutes()),this.setTime(name,moment(date).format("HH"),moment(date).format("mm")),this}changeTime(name,date){return this.values[name]=parseInt(moment(parseInt(date)).startOf("day").add(moment(this.values[name+"Time"]).format("HH"),"h").add(moment(this.values[name+"Time"]).format("mm"),"m").valueOf()),this}swapTime(){return this.renderTime("time1",this.getStart()),this.renderTime("time2",this.getEnd()),this}setTime(name,hour,minute){let $elm=this.getElm(),start=this.getStart();switch(hour&&$elm.find("."+name+" .hour-val").text(hour),minute&&$elm.find("."+name+" .minute-val").text(minute),name){case"time1":start&&_setRange("start",moment(start)),_setRange("startTime",moment(this.values.startTime||moment().valueOf()));break;case"time2":this.values.end&&_setRange("end",moment(this.values.end)),_setRange("endTime",moment(this.values.endTime||moment().valueOf()))}var _setRange=(name,timePoint)=>{var h=timePoint.format("HH"),m=timePoint.format("mm");this.values[name]=timePoint.startOf("day").add(hour||h,"h").add(minute||m,"m").valueOf()};return this.validateSelection(),this.updateSelectionInHeader(),this.showSelectedDates(),this}clearSelection(){let $elm=this.getElm();return this.setStart(null),this.setEnd(null),$elm.find(".checked").removeClass("checked"),$elm.find(".last-date-selected").removeClass("last-date-selected"),$elm.find(".first-date-selected").removeClass("first-date-selected"),this.setTargetValue(""),this.validateSelection(),this.updateSelectionInHeader(),this.showSelectedDates(),this}handleStart(time){let is_isoweek=this.isIsoWeek(),r=time;return"week-range"===this.values.batch_mode?r=(is_isoweek?moment(parseInt(time)).startOf("isoweek"):moment(parseInt(time)).startOf("week")).valueOf():"month-range"===this.values.batch_mode&&(r=moment(parseInt(time)).startOf("month").valueOf()),r}handleEnd(time){let is_isoweek=this.isIsoWeek(),r=time;return"week-range"===this.values.batch_mode?r=(is_isoweek?moment(parseInt(time)).endOf("isoweek"):moment(parseInt(time)).endOf("week")).valueOf():"month-range"===this.values.batch_mode&&(r=moment(parseInt(time)).endOf("month").valueOf()),r}isEditableUsage(){return this.values.is_editable_usage}getCurrentView(month){return this.values.view[month]}setCurrentView(month,view){return this.values.view[month]=view,this}onDateChanged(event){this.getTarget();let{$cell,$table,month,view}=this.getEventData(event),time=moment(parseInt($cell.attr("data-value"))),is_autoclose=this.isAutoClose(),is_isoweek=this.isIsoWeek(),is_editable_usage=this.isEditableUsage(),is_single_date=this.isSingleDate(),start=this.getStart(),end=this.getEnd();if(!$cell.hasClass("invalid")){switch($cell.addClass("checked"),this.clearOnCellHover(),is_single_date&&(start=time.valueOf(),end=null),!0){case/days/.test(view):"week"===this.values.batch_mode?is_isoweek?(start=time.startOf("isoweek").valueOf(),end=time.endOf("isoweek").valueOf()):(end=time.endOf("week").valueOf(),start=time.startOf("week").valueOf()):"workweek"===this.values.batch_mode?(start=time.day(1).valueOf(),end=time.day(5).valueOf()):"weekend"===this.values.batch_mode?(start=time.day(6).valueOf(),end=time.day(7).valueOf()):"month"===this.values.batch_mode?(start=time.startOf("month").valueOf(),end=time.endOf("month").valueOf()):start&&end||!start&&!end?(start=this.handleStart(time.valueOf()),end=null):start&&(end=this.handleEnd(time.valueOf()),this.values.time.enabled&&this.changeTime("end",end)),this.values.time.enabled&&(start&&this.changeTime("start",start),end&&this.changeTime("end",end)),!is_single_date&&start&&end&&start>end&&(tmp=end,end=this.handleEnd(start),start=this.handleStart(tmp),this.values.time.enabled&&this.values.swap_time&&this.swapTime());break;case/^months$|^years$/.test(view):var tmp,_unit,_count,opposite_month=/month1/.test(month)?"month2":"month1",start_date=!!this.values.start_date&&this._getMomentDate(this.values.start_date),end_date=!!this.values.end_date&&this._getMomentDate(this.values.end_date),unit=view;/^months$/.test(view)?this.setCurrentView(month,/^months$/i.test(this.values.min_view_mode)?"months":"days"):this.setCurrentView(month,/^years$/i.test(this.values.min_view_mode)?"years":"months"),/^months$|^years$/i.test(this.values.min_view_mode)&&(time.startOf(unit),view===this.values.min_view_mode&&(start&&end||!start&&!end?(start=time.valueOf(),end=!1):start&&(end=time.valueOf()),!is_single_date&&start&&end&&start>end&&(tmp=end,end=start,start=tmp))),start_date&&time.isSameOrBefore(start_date)&&(time=start_date.add("month2"===month?1:0,unit)),end_date&&time.isSameOrAfter(end_date)&&(time=end_date.add(this.values.single_month||"month1"!==month?0:-1,unit)),this.renderCalendar(time.toDate(),month),/month1/.test(month)?(this.values.sticky||time.isSameOrAfter(this.values[opposite_month],unit))&&(_unit=/^months$|^years$/.test(this.values.min_view_mode)?"years":"months",_count=/days|months/.test(this.values.min_view_mode)?1:10,this.renderCalendar(time.add(_count,_unit),opposite_month)):(this.values.sticky||time.isSameOrBefore(this.values[opposite_month],unit))&&(_unit=/^months$|^years$/.test(this.values.min_view_mode)?"years":"months",_count=/days|months/.test(this.values.min_view_mode)?-1:-10,this.renderCalendar(time.add(_count,_unit),opposite_month))}this.setStart(start),this.setEnd(end),start&&!end?(this.fns("onStartSelected",{start:new Date(start)}),this.onCellHover(event)):start&&end&&this.fns("onEndSelected",{start:new Date(start),end:new Date(end)}),this.showDivider(),this.updateSelectableRange(month),this.validateSelection(),this.updateSelectionInHeader(),this.showSelectedDates(),$table.attr("data-view",this.values.view[month]),start&&end&&(is_editable_usage||is_autoclose||/^months$|^years$/i.test(this.values.min_view_mode))&&this.triggerApply(),(/days/.test(view)&&/^days$/i.test(this.values.min_view_mode)||/months/.test(view)&&/^months$/i.test(this.values.min_view_mode)||/years/.test(view)&&/^years$/i.test(this.values.min_view_mode))&&this.autoClose()}}isDate(date){return date&&moment(new Date(date)).isValid()}triggerApply(data={}){let is_single_date=this.isSingleDate(),start="start"in data?data.start:this.getStart(),end="end"in data?data.end:this.getEnd(),range="",options={};return options=is_single_date?(range=this.isDate(start)?this.getDateString(new Date(start)):start,{date:new Date(start),range:range}):(range=(this.isDate(start)?this.getDateString(new Date(start)):start)+this.values.separator+(this.isDate(end)?this.getDateString(new Date(end)):end),{start:this.isDate(start)?new Date(start):start,end:this.isDate(end)?new Date(end):end,range:range}),this.setTargetValue(range),this.fns("onApply",options),this}isIsoWeek(){return/monday/i.test(this.getStartOfWeek())}isSingleDate(){return this.values.single_date}weekNumberClicked(event){var date1,{$cell:event,month}=this.getEventData(event),$elm=this.getElm(),is_isoweek=this.isIsoWeek(),thisTime=parseInt(event.attr("data-start-time"),10);return this.values.start_week?($elm.find(".week-number-selected").removeClass("week-number-selected"),date1=new Date(thisTime<this.values.start_week?thisTime:this.values.start_week),$elm=new Date(thisTime<this.values.start_week?this.values.start_week:thisTime),this.values.start_week=!1,this.setStart(moment(date1).day(is_isoweek?1:0).valueOf()),this.setEnd(moment($elm).day(is_isoweek?7:6).valueOf())):(this.values.start_week=thisTime,event.addClass("week-number-selected"),date1=new Date(thisTime),this.setStart(moment(date1).day(is_isoweek?1:0).valueOf()),this.setEnd(moment(date1).day(is_isoweek?7:6).valueOf())),this.updateSelectableRange(month),this.validateSelection(),this.updateSelectionInHeader(),this.showSelectedDates(),this.autoClose(),this.triggerApply(),this}compareDates(date1,date2){return/^days$/i.test(this.values.min_view_mode)?this.compareDay(date1,date2):/^months$/i.test(this.values.min_view_mode)?this.compareMonth(date1,date2):/^years$/i.test(this.values.min_view_mode)?this.compareYear(date1,date2):void 0}isValidTime(time,month){var time=parseInt(time),view=this.getCurrentView(month),month=this.isSingleDate(),start=this.getStart(),end=this.getEnd(),start_date=this.values.start_date,end_date=this.values.end_date;if(/^days$/i.test(this.values.min_view_mode)&&/^months|years$/i.test(view)&&(start_date=start_date&&this._getMomentDate(this.values.start_date).startOf("month").toDate(),end_date=end_date&&moment(this.values.end_date).endOf("month").toDate()),start_date&&this.compareDates(time,start_date)<0||end_date&&0<this.compareDates(time,end_date))return!1;if(start&&!end&&!month){let min=this.values.min_days,max=this.values.max_days;if(/^months$/i.test(this.values.min_view_mode)?(min=this.values.min_months,max=this.values.max_months):/^years$/i.test(this.values.min_view_mode)&&(min=this.values.min_years,max=this.values.max_years),0<max&&this.countDiff(time,start)>max||0<min&&this.countDiff(time,start)<min)return!1;if(this.values.select_forward&&time<start||this.values.select_backward&&start<time)return!1;if("customDateFilter"in this.values.custom_methods_override){for(var valid=!0,timeTmp=time;1<this.countDiff(timeTmp,start)&&(valid=this.customDateFilter(new Date(timeTmp),view))&&!(Math.abs(moment(timeTmp).diff(moment(start),this.values.min_view_mode))<1);)moment(timeTmp).isAfter(moment(start),this.values.min_view_mode)&&(timeTmp=moment(timeTmp).add(-1,this.values.min_view_mode).valueOf()),moment(timeTmp).isBefore(moment(start),this.values.min_view_mode)&&(timeTmp=moment(timeTmp).add(1,this.values.min_view_mode).valueOf());if(!valid)return!1}}return!0}updateSelectableRange(month){let $elm=this.getElm(),start=this.getStart(),end=this.getEnd();return $elm.find(".cell.invalid.tmp").removeClass("tmp invalid").addClass("valid"),start&&!end&&_.each($elm.find(".cell.valid:not(.other-month)"),cell=>{var cell=$(cell),time=parseInt(cell.attr("data-value"),10);this.isValidTime(time,month)?cell.addClass("valid tmp").removeClass("invalid"):cell.addClass("invalid tmp").removeClass("valid")}),!0}showTooltip(){return this.values.show_tooltip}getEventData(event){let $cell=$(event.currentTarget),$table=$cell.closest("table"),month=$table.hasClass("month2")?"month2":"month1",view=this.getCurrentView(month);return{$cell:$cell,$table:$table,month:month,view:view}}onCellHover(event){var $tip,$elm=this.getElm(),{$cell:event,view}=this.getEventData(event),show_tooltip=this.showTooltip(),is_mobile=this.isMobile(),is_single_date=this.isSingleDate(),hover_time=parseInt(event.attr("data-value")),tooltip="",start=this.getStart(),end=this.getEnd();return view===this.values.min_view_mode&&(event.hasClass("has-tooltip")&&event.attr("data-tooltip")?tooltip='<span class="tooltip-content">'+event.attr("data-tooltip")+"</span>":event.hasClass("invalid")||(is_single_date?($elm.find(".cell.hovering").removeClass("hovering"),event.addClass("hovering")):(_.each($elm.find(".cell"),cell=>{var cell=$(cell),time=parseInt(cell.attr("data-value"));time==hover_time?cell.addClass("hovering"):cell.removeClass("hovering"),start&&!this.values.end&&(start<time&&time<=hover_time||time<start&&hover_time<=time)?cell.addClass("hovering"):cell.removeClass("hovering")}),start&&!end&&(view=this.countDiff(hover_time,start),show_tooltip&&(is_mobile?1<view&&(tooltip=view+" "+this.translate(this.values.min_view_mode)):tooltip=this.hoveringTooltip(view,start,hover_time))))),tooltip?($tip=$('<div class="date-range-length-tip"></div>').html("<span>"+tooltip+"</span>"),event.append($tip),$tip.width(),setTimeout(()=>{$tip.css({visibility:"visible"})},10)):$elm.find(".date-range-length-tip").remove()),this}clearOnCellHover(){let $elm=this.getElm();return $elm.find(".cell.hovering").removeClass("hovering"),$elm.find(".date-range-length-tip").remove(),this}isAutoClose(){return this.values.auto_close}autoClose(){var is_activated=this.isActivated(),is_autoclose=this.isAutoClose(),is_single_date=this.isSingleDate(),start=this.getStart(),end=this.getEnd();return is_activated&&(is_single_date&&start||start&&end)&&is_autoclose&&this.hide(),this}validateSelection(){var $elm=this.getElm(),start=moment(this.getStart()||null),end=moment(this.getEnd()||null),units_apart=start.isValid()&&end.isValid()?end.diff(start,this.values.min_view_mode)+1:NaN,min=this.values.min_days,max=this.values.max_days,is_single_date=this.isSingleDate();return/^months$/i.test(this.values.min_view_mode)?(min=this.values.min_months,max=this.values.max_months):/^years$/i.test(this.values.min_view_mode)&&(min=this.values.min_years,max=this.values.max_years),is_single_date?start.isValid()&&!end.isValid()?$elm.find(".drp_top-bar").removeClass("error").addClass("normal"):$elm.find(".drp_top-bar").removeClass("error").removeClass("normal"):max&&max<units_apart?(this.setStart(null),this.setEnd(null),$elm.find(".cell").removeClass("checked"),$elm.find(".drp_top-bar").removeClass("normal").addClass("error").find(".error-top").html(this.translate("less-than").replace("%d",max))):min&&units_apart<min?(this.setStart(null),this.setEnd(null),$elm.find(".cell").removeClass("checked"),$elm.find(".drp_top-bar").removeClass("normal").addClass("error").find(".error-top").html(this.translate("more-than").replace("%d",min))):start.isValid()||end.isValid()?$elm.find(".drp_top-bar").removeClass("error").addClass("normal"):$elm.find(".drp_top-bar").removeClass("error").removeClass("normal"),is_single_date&&this.getStart()&&!this.getEnd()||!is_single_date&&this.getStart()&&this.getEnd()?$elm.find(".apply-btn").removeClass("disabled"):$elm.find(".apply-btn").addClass("disabled"),this.values.batch_mode&&(this.getStart()&&this.values.start_date&&this.compareDates(this.getStart(),this.values.start_date)<0||this.getEnd()&&this.values.end_date&&0<this.compareDates(this.getEnd(),this.values.end_date))&&(this.setStart(null),this.setEnd(null),$elm.find(".cell").removeClass("checked")),this}updateSelectionInHeader(force_validate,silent){let $elm=this.getElm(),start=this.getStart(),end=this.getEnd(),is_activated=this.isActivated(),is_show_topbar=this.isShowTopbar(),is_autoclose=this.isAutoClose(),is_single_date=this.isSingleDate(),range;return is_show_topbar&&($elm.find(".start-day").html("..."),$elm.find(".end-day").html("..."),$elm.find(".selected-days").addClass("hide"),start&&$elm.find(".start-day").html(this.getDateString(new Date(parseInt(start)))),end&&$elm.find(".end-day").html(this.getDateString(new Date(parseInt(end))))),start?is_single_date?($elm.find(".apply-btn").removeClass("disabled"),range=this.getDateString(new Date(start)),is_autoclose&&this.setTargetValue(range),is_activated&&!silent&&this.fns("onDateChanged",{range:range,date1:new Date(start)})):end&&($elm.find(".selected-days").removeClass("hide").find(".selected-days-num").html(this.countDiff(end,start)),$elm.find(".apply-btn").removeClass("disabled"),range=this.getDateString(new Date(start))+this.values.separator+this.getDateString(new Date(end)),is_autoclose&&this.setTargetValue(range),is_activated&&!silent&&this.fns("onDateChanged",{range:range,date1:new Date(start),date2:new Date(end)})):force_validate?$elm.find(".apply-btn").removeClass("disabled"):$elm.find(".apply-btn").addClass("disabled"),this}countDiff(start,end){return Math.abs(moment(start).diff(moment(end),this.values.min_view_mode))+1}setDateRange(date1,date2,silent){var date_format=this.getDateFormat(),date_format=("string"==typeof date1&&"string"==typeof date2&&(date1=moment(date1,date_format).toDate(),date2=moment(date2,date_format).toDate()),date1.getTime()>date2.getTime()&&(date_format=date2,date2=date1,date1=date_format,date_format=null),!0);if(date_format=!(this.values.start_date&&this.compareDates(date1,this.values.start_date)<0||this.values.end_date&&0<this.compareDates(date2,this.values.end_date))&&date_format)return this.setStart(date1.getTime()),this.setEnd(date2.getTime()),this.values.time.enabled&&(this.renderTime("time1",date1),this.renderTime("time2",date2)),this.values.sticky?/days/.test(this.values.min_view_mode)?0===this.compareMonth(date1,date2)?this.values.look_behind?date1=this.prevMonth(date2):date2=this.nextMonth(date1):!1!==this.values.end_date&&0<this.compareMonth(date2,this.values.end_date)&&(date1=this.prevMonth(date1),date2=this.prevMonth(date2)):/months/.test(this.values.min_view_mode)?0===this.compareYear(date1,date2)?this.values.look_behind?date1=this.prevYear(date2):date2=this.nextYear(date1):!1!==this.values.end_date&&0<this.compareYear(date2,this.values.end_date)&&(date1=this.prevYear(date1),date2=this.prevYear(date2)):/years/.test(this.values.min_view_mode)&&(0===this.compareDecade(date1,date2)?this.values.look_behind?date1=this.prevDecade(date2):date2=this.nextDecade(date1):!1!==this.values.end_date&&0<this.compareDecade(date2,this.values.end_date)&&(date1=this.prevDecade(date1),date2=this.prevDecade(date2))):/days/.test(this.values.min_view_mode)&&0===this.compareMonth(date1,date2)?this.values.look_behind?date1=this.prevMonth(date2):date2=this.nextMonth(date1):/months/.test(this.values.min_view_mode)&&0===this.compareYear(date1,date2)?this.values.look_behind?date1=this.prevYear(date2):date2=this.nextYear(date1):/years/.test(this.values.min_view_mode)&&0===this.compareDecade(date1,date2)&&(this.values.look_behind?date1=this.prevDecade(date2):date2=this.nextDecade(date1)),this.renderCalendar(date1,"month1"),this.renderCalendar(date2,"month2"),this.showDivider(),this.validateSelection(),this.updateSelectionInHeader(!1,silent),this.autoClose(),this;this.renderCalendar(this.values.start_date,"month1"),this.renderCalendar(this.nextMonth(this.values.start_date),"month2"),this.showDivider()}setSingleDate(date){var start=this.getStart(),end=this.getEnd();return start&&this.compareDates(date,start)<0||end&&0<this.compareDates(date,end)?this.renderCalendar(start,"month1"):(this.setStart(date),this.values.time.enabled&&this.renderTime("time1",date),this.renderCalendar(date,"month1"),this.values.single_month||this.renderCalendar(this.nextMonth(date),"month2"),this.showDivider(),this.updateSelectionInHeader(),this.autoClose()),this}showSelectedDates(){let $elm=this.getElm(),start=this.getStart(),end=this.getEnd();return(start||end)&&(_.each($elm.find(".cell"),cell=>{var cell=$(cell),time=parseInt(cell.attr("data-value")),_start=start,_end=end;this.values.time.enabled&&(time=moment(time).startOf("day").valueOf(),_start=moment(_start||moment().valueOf()).startOf("day").valueOf(),_end=moment(_end||moment().valueOf()).startOf("day").valueOf()),start&&end&&time<=_end&&_start<=time||start&&!end&&moment(_start).format("YYYY-MM-DD")==moment(time).format("YYYY-MM-DD")?cell.addClass("checked"):cell.removeClass("checked"),start&&moment(_start).format("YYYY-MM-DD")==moment(time).format("YYYY-MM-DD")?cell.addClass("first-date-selected"):cell.removeClass("first-date-selected"),end&&moment(_end).format("YYYY-MM-DD")==moment(time).format("YYYY-MM-DD")?cell.addClass("last-date-selected"):cell.removeClass("last-date-selected")}),_.each($elm.find(".week-number"),cell=>{cell=$(cell);cell.attr("data-start-time")==this.values.start_week&&cell.addClass("week-number-selected")})),this}renderCalendar(date,month){var $elm=this.getElm(),$caption_title=$elm.find("."+month+" .caption-title"),$elm=$elm.find("."+month+" tbody"),date=moment(date).toDate(),$body_content=null;switch(this.getCurrentView(month)){case"days":$caption_title.html(this.nameMonth(date.getMonth())+" "+date.getFullYear()),$body_content=this.createDaysHtml(date,month);break;case"months":$caption_title.html(date.getFullYear()),$body_content=this.createMonthsHtml(date,month);break;case"years":let decade=this.getDecade(date);$caption_title.html(decade.first()+"-"+decade.last()),$body_content=this.createYearsHtml(date,month)}return $elm.html($body_content),this.values[month]=date,this.updateSelectableRange(month),this}getDecade(date){date=10*Math.floor(date.getFullYear()/10);return[date,9+date]}createMonthsHtml(date,month){let html="",i=0,today=(/^month1$/i.test(month)?this.getStart():this.getEnd(),moment()),view=this.getCurrentView(month);for(;i<12;){let _month=new Date(date.getFullYear(),i).getMonth(),month_in_loop=moment(date).month(_month),is_today_month=today.isSame(moment(date).month(_month),"month"),valid=this.isValidTime(month_in_loop.valueOf(),month);valid=(valid=/^months$/.test(this.values.min_view_mode)&&(this.values.start_date&&this.compareMonth(month_in_loop.toDate(),this.values.start_date)<0||this.values.end_date&&0<this.compareMonth(month_in_loop.toDate(),this.values.end_date))?!1:valid)&&this.customDateFilter(month_in_loop.toDate(),view),html+='<div class="cell cell-month '+(is_today_month?"cell-current":"")+" "+(valid?"valid":"invalid")+'" data-value="'+month_in_loop.valueOf()+'">'+this.nameMonth(_month)+"</div>",i++}return'<tr><td colspan="3"><div class="cell-wrapper">'+html+"</div></td></tr>"}createYearsHtml(date,month){var decade=this.getDecade(date),first_year=decade.first(),last_year=decade.last(),html="",today=moment(),view=this.getCurrentView(month);for(let i=first_year-1;i<=last_year+1;i++){let year=new Date(i,0).getFullYear(),year_in_loop=moment(date).year(year),is_today_year=today.isSame(year_in_loop,"year"),is_other_decade=i<first_year||i>last_year,valid=this.isValidTime(year_in_loop.valueOf(),month);html+='<div class="cell cell-year '+(is_today_year?"cell-current":"")+" "+(is_other_decade?"other-decade":"")+" "+((valid=(valid=/^years$/.test(this.values.min_view_mode)&&(this.values.start_date&&this.compareYear(year_in_loop.toDate(),this.values.start_date)<0||this.values.end_date&&0<this.compareYear(year_in_loop.toDate(),this.values.end_date))?!1:valid)&&this.customDateFilter(year_in_loop.toDate(),view))?"valid":"invalid")+'" data-value="'+year_in_loop.valueOf()+'">'+year+"</div>"}return'<tr><td colspan="3"><div class="cell-wrapper">'+html+"</div></td></tr>"}showTime(date,name){let $elm=this.getElm();return $elm.find("."+name).append(this.getTimeHTML()),this.renderTime(name,date),this}nameMonth(m){return this.translate("month-name")[m]}getDateString(d){return moment(d).format(this.getDateFormat())}showDivider(){this.showSelectedDates();var cal1_date=moment(this.values.month1),cal2_date=moment(this.values.month2),show_divider=!1,$elm=this.getElm(),cal2_date=((show_divider=/years/i.test(this.values.min_view_mode)&&12<cal2_date.diff(cal1_date,"years")||/months/i.test(this.values.min_view_mode)&&1<cal2_date.diff(cal1_date,"years")||/days/i.test(this.values.min_view_mode)&&1<cal2_date.diff(cal1_date,"months")?!0:show_divider)?$elm.addClass("has-gap").removeClass("no-gap").find(".gap").css("visibility","visible"):$elm.removeClass("has-gap").addClass("no-gap").find(".gap").css("visibility","hidden"),$elm.find("table.month1").height()),cal1_date=$elm.find("table.month2").height();return $elm.find(".gap").height(Math.max(cal2_date,cal1_date)+10),this}redrawDatePicker(){return this.renderCalendar(this.values.month1,"month1"),this.renderCalendar(this.values.month2,"month2"),this}compareDecade(date1,date2){let decade1=this.getDecade(date1),decade2=this.getDecade(date2),start_year1=decade1.first(),start_year2=decade2.first();return start_year2<start_year1?1:start_year1===start_year2?0:-1}_getMomentDate(date){return"string"==typeof date?moment(date,this.getDateFormat()):moment(date)}compareYear(date1,date2){date1=parseInt(this._getMomentDate(date1).format("YYYY"))-parseInt(this._getMomentDate(date2).format("YYYY"));return 0<date1?1:0==date1?0:-1}compareMonth(date1,date2){date1=parseInt(this._getMomentDate(date1).format("YYYYMM"))-parseInt(this._getMomentDate(date2).format("YYYYMM"));return 0<date1?1:0==date1?0:-1}compareDay(date1,date2){date1=parseInt(this._getMomentDate(date1).format("YYYYMMDD"))-parseInt(this._getMomentDate(date2).format("YYYYMMDD"));return 0<date1?1:0==date1?0:-1}nextMonth(date){return moment(date).add(1,"months").toDate()}prevMonth(date){return moment(date).add(-1,"months").toDate()}nextYear(date){return moment(date).add(1,"years").toDate()}prevYear(date){return moment(date).add(-1,"years").toDate()}nextDecade(date){return moment(date).add(10,"years").toDate()}prevDecade(date){return moment(date).add(-10,"years").toDate()}getTimeHTML(){return"<div><span>"+this.translate("Time")+': <span class="hour-val">00</span>:<span class="minute-val">00</span></span></div><div class="hour"><label class="form-label">'+this.translate("Hour")+': <input type="range" class="hour-range" name="hour" min="0" max="23"></label></div><div class="minute"><label class="form-label">'+this.translate("Minute")+': <input type="range" class="minute-range" name="minute" min="0" max="59"></label></div>'}getWeekHead(){var is_isoweek=this.isIsoWeek(),prepend=this.values.show_week_numbers?"<th>"+this.translate("week-number")+"</th>":"";return is_isoweek?prepend+"<th>"+this.translate("week-1")+"</th><th>"+this.translate("week-2")+"</th><th>"+this.translate("week-3")+"</th><th>"+this.translate("week-4")+"</th><th>"+this.translate("week-5")+"</th><th>"+this.translate("week-6")+"</th><th>"+this.translate("week-7")+"</th>":prepend+"<th>"+this.translate("week-7")+"</th><th>"+this.translate("week-1")+"</th><th>"+this.translate("week-2")+"</th><th>"+this.translate("week-3")+"</th><th>"+this.translate("week-4")+"</th><th>"+this.translate("week-5")+"</th><th>"+this.translate("week-6")+"</th>"}isDateOutOfBounds(date){let date1=moment(date),is_outside=!1;if(/years/.test(this.values.min_view_mode)){let decade=this.getDecade(date);is_outside=!!(this.values.start_date&&decade.last()<this.values.start_date.getFullYear()||this.values.end_date&&decade.first()>this.values.start_date.getFullYear())}else{date=/months/.test(this.values.min_view_mode)?"year":"month";is_outside=!!(this.values.start_date&&date1.endOf(date).isBefore(this.values.start_date)||this.values.end_date&&date1.startOf(date).isAfter(this.values.end_date))}return is_outside}getGapHTML(){for(var html=['<div class="gap-lines">'],i=0;i<20;i++)html.push('<div class="gap-line"><div class="gap-1"></div><div class="gap-2"></div><div class="gap-3"></div></div>');return html.push("</div>"),html.join("")}hasMonth2(){return!this.values.single_month}attributesCallbacks(initialObject,callbacksArray,today){var attr,resultObject=_.extend({},initialObject),attrString=(_.each(callbacksArray,(cbAttr,cbAttrIndex)=>{var attr,addAttributes=cbAttr(today);for(attr in addAttributes)resultObject.hasOwnProperty(attr)?resultObject[attr]+=addAttributes[attr]:resultObject[attr]=addAttributes[attr]}),"");for(attr in resultObject)resultObject.hasOwnProperty(attr)&&(attrString+=attr+'="'+resultObject[attr]+'" ');return attrString}createDaysHtml(date,month){date.setDate(1);var is_isoweek=this.isIsoWeek(),days=[],now=new Date,day_of_week=date.getDay(),view=this.getCurrentView(month);if(0<(day_of_week=0===day_of_week&&is_isoweek?7:day_of_week))for(var i=day_of_week;0<i;i--){var day=new Date(date.getTime()-864e5*i),valid=this.isValidTime(day.getTime(),month);this.values.start_date&&this.compareDates(day,this.values.start_date)<0&&(valid=!1),this.values.end_date&&0<this.compareDates(day,this.values.end_date)&&(valid=!1),days.push({date:day,type:"prev-month",day:day.getDate(),time:day.getTime(),valid:valid})}for(var curr_month=date.getMonth(),i=0;i<40;i++)today=moment(date).add(i,"days").toDate(),valid=this.isValidTime(today.getTime(),month),(this.values.start_date&&this.compareDates(today,this.values.start_date)<0||this.values.end_date&&0<this.compareDates(today,this.values.end_date))&&(valid=!1),days.push({date:today,type:today.getMonth()!=curr_month?"next-month":"",day:today.getDate(),time:today.getTime(),valid:valid});for(var html=[],week=0;week<6&&"next-month"!==days[7*week].type;week++){html.push("<tr>");for(day=0;day<7;day++){var today=days[7*week+(is_isoweek?day+1:day)],highlight_today=moment(today.time).format("L")==moment(now).format("L"),highlight_today=(today.extra_class="",today.tooltip="",today.valid&&(today.valid=this.customDateFilter(moment(today.time).toDate(),view)),{"data-value":today.time,"data-tooltip":today.tooltip,class:"cell cell-day "+today.type+" "+today.extra_class+" "+(today.valid?"valid":"invalid")+" "+(highlight_today?"real-today":"")});0===day&&this.values.show_week_numbers&&html.push('<td><div class="week-number" data-start-time="'+today.time+'">'+this.getWeekNumber(today.date)+"</div></td>"),html.push("<td "+this.attributesCallbacks({},this.values.day_td_attributes,today)+"><div "+this.attributesCallbacks(highlight_today,this.values.day_div_attributes,today)+">"+this.customDateHtml(today.time)+"</div></td>")}html.push("</tr>")}return html.join("")}customDateHtml(date){return moment(date).date()}customDateFilter(date,view){return!0}getLanguages(){var language;return"auto"==this.values.language?(language=navigator.language||navigator.browserLanguage)&&(language=language.toLowerCase())in utils_daterange_i18n?utils_daterange_i18n[language]:utils_daterange_i18n.default:this.values.language&&this.values.language in utils_daterange_i18n?utils_daterange_i18n[this.values.language]:utils_daterange_i18n.default}translate(translation_key){let languages=this.getLanguages(),translation_key_lcase=translation_key.toLowerCase(),result=translation_key in languages?languages[translation_key]:translation_key_lcase in languages?languages[translation_key_lcase]:null,default_language=utils_daterange_i18n.default;return result=null==result?translation_key in default_language?default_language[translation_key]:translation_key_lcase in default_language?default_language[translation_key_lcase]:"":result}getDefaultDate(){var default_date=this.values.defaultDate||new Date,is_single_date=this.isSingleDate();return this.values.look_behind?(this.values.start_date&&this.compareMonth(default_date,this.values.start_date)<0&&(default_date=this.nextMonth(this._getMomentDate(this.values.start_date).toDate())),this.values.end_date&&0<this.compareMonth(default_date,this.values.end_date)&&(default_date=this._getMomentDate(this.values.end_date).toDate())):(this.values.start_date&&this.compareMonth(default_date,this.values.start_date)<0&&(default_date=this._getMomentDate(this.values.start_date).toDate()),this.values.end_date&&0<this.compareMonth(this.nextMonth(default_date),this.values.end_date)&&(default_date=this.prevMonth(this._getMomentDate(this.values.end_date).toDate()))),is_single_date&&(this.values.start_date&&this.compareMonth(default_date,this.values.start_date)<0&&(default_date=this._getMomentDate(this.values.start_date).toDate()),this.values.end_date&&0<this.compareMonth(default_date,this.values.end_date)&&(default_date=this._getMomentDate(this.values.end_date).toDate())),default_date}resetMonthsView(date){var prev_date;return date=date||this.getDefaultDate(),this.values.view.month1=this.values.view.month2=this.values.min_view_mode,this.values.look_behind?(prev_date=/years/.test(this.values.min_view_mode)?this.prevDecade(date):/months/.test(this.values.min_view_mode)?this.prevYear(date):this.prevMonth(date),this.renderCalendar(prev_date,"month1"),this.renderCalendar(date,"month2")):(prev_date=/years/.test(this.values.min_view_mode)?this.nextDecade(date):/months/.test(this.values.min_view_mode)?this.nextYear(date):this.nextMonth(date),this.renderCalendar(date,"month1"),this.renderCalendar(prev_date,"month2")),this.isSingleDate()&&this.renderCalendar(date,"month1"),this.showSelectedDates(),this.showDivider(),this}outsideClickClose(evt){let $elm=this.getElm(),$target=this.getTarget();this.isOwnDatePickerClicked(evt,$target[0])||$elm.is(":visible")&&this.hide()}},"undefined"!=typeof module&&module.hasOwnProperty("exports")&&(module.exports=UTILS.Daterange);