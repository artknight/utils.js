function empty(mixed_var){var key,i,len,emptyValues=[void 0,null,!1,0,"","0"];for(i=0,len=emptyValues.length;i<len;i++)if(mixed_var===emptyValues[i])return!0;if("object"==typeof mixed_var){for(key in mixed_var)return!1;return!0}return!1}!function(window,$,undefined){"use strict";$.imageUploader=function(options,element){this.element=element,this.options=$.extend(!0,{},$.imageUploader.defaults,options,$(this.element).data()),this.input=$(this.element).find("input[type=file]");$(window);this.interval=null,this.drag=!1,this.widthPercentage=100,this.button={},this.button.edit='<div class="btn btn-info btn-edit" title="'+(this.options.editTitle||"Edit")+'"><i class="mdi mdi-pencil"></i></div>',this.button.saving='<div class="btn btn-warning saving">'+(this.options.saveLabel||"Saving...")+' <i class="mdi mdi-clock"></i></div>',this.button.zoomin='<div class="btn btn-light btn-zoom-in" title="'+(this.options.zoominTitle||"Zoom in")+'"><i class="mdi mdi-magnify-plus"></i></div>',this.button.zoomout='<div class="btn btn-light btn-zoom-out" title="'+(this.options.zoomoutTitle||"Zoom out")+'"><i class="mdi mdi-magnify-minus"></i></div>',this.button.zoomreset='<div class="btn btn-light btn-zoom-reset" title="'+(this.options.zoomresetTitle||"Fullsize")+'"><i class="mdi mdi-fullscreen"></i></div>',this.button.cancel='<div class="btn btn-danger btn-cancel" title="'+(this.options.cancelTitle||"Cancel")+'"><i class="mdi mdi-cancel"></i></div>',this.button.done='<div class="btn btn-success btn-ok" title="'+(this.options.okTitle||"Ok")+'"><i class="mdi mdi-check"></i></div>',this.button.del='<div class="btn btn-danger btn-del" title="'+(this.options.delTitle||"Delete")+'"><i class="mdi mdi-delete"></i></div>',this.button.download='<a class="btn btn-warning download"><i class="mdi mdi-download"></i> '+(this.options.downloadLabel||"Download")+"</a>",this.imageMimes={png:"image/png",bmp:"image/bmp",gif:"image/gif",jpg:"image/jpeg",jpeg:"image/jpeg",tiff:"image/tiff"},this._init()},$.imageUploader.defaults={width:null,height:null,image:null,ghost:!0,originalsize:!0,url:!1,removeurl:{},data:{},canvas:!0,canvasImageOnly:!1,ajax:!0,resize:!1,dimensionsonly:!1,editstart:!1,saveOriginal:!1,save:!0,download:!1,smaller:!1,smallerWidth:!1,smallerHeight:!1,background:null,onAfterZoomImage:null,onAfterInitImage:null,onAfterMoveImage:null,onAfterUploadImage:null,onAfterResetImage:null,onAfterCancel:null,onAfterRemoveImage:null,onAfterSelectImage:null},$.imageUploader.prototype={_init:function(){var width,height,imageWidth,imageHeight,_self=this,options=_self.options,element=_self.element,input=_self.input;if(empty($(element)))return!1;if($(element).children().css({position:"absolute"}),!(window.FormData&&"upload"in $.ajaxSettings.xhr()))return $(element).empty().attr("class","").addClass("alert alert-danger").html("Upload Image: Sadly.. this browser does not support the plugin, update your browser today!"),!1;if(!empty(options.width)&&empty(options.height)&&$(element).innerHeight()<=0)return $(element).empty().attr("class","").addClass("alert alert-danger").html("Upload Image: Image height is not set and can not be calculated..."),!1;if(!empty(options.height)&&empty(options.width)&&$(element).innerWidth()<=0)return $(element).empty().attr("class","").addClass("alert alert-danger").html("Upload Image: Image width is not set and can not be calculated..."),!1;if($(element).data("style",$(element).attr("style")),$(element).data("class",$(element).attr("class")),options.width=imageWidth=options.width||$(element).outerWidth(),options.height=imageHeight=options.height||$(element).outerHeight(),$(element).innerWidth()>0?width=$(element).outerWidth():$(element).innerHeight()>0?width=null:empty(options.width)||(width=options.width),$(element).innerHeight()>0?height=$(element).outerHeight():$(element).innerWidth()>0?height=null:empty(options.height)||(height=options.height),height=height||width/(imageWidth/imageHeight),(width=width||height/(imageHeight/imageWidth))<240&&$(element).addClass("smalltools smalltext"),_self.widthPercentage=$(element).outerWidth()/$(element).offsetParent().width()*100,1==options.resize&&$(window).resize(function(){_self.resize()}),_self._bind(),(options.required||$(input).prop("required"))&&(_self.options.required=!0,$(input).prop("required",!0)),options.ajax||_self._formValidation(),empty(options.image)||0!=options.editstart)empty(options.image)?_self.toggleDropzoneClass(!0):_self.readImage(options.image,options.image,options.image,_self.imageMimes[options.image.split(".").pop()]);else{$(element).data("name",options.image).addClass("image-exists").append($("<img />").addClass("preview").attr("src",options.image)),_self.toggleDropzoneClass(!1);var tools=$('<div class="preview tools"></div>'),del=($(""+this.button.edit),$(""+this.button.del));$(del).unbind("click").click(function(e){e.preventDefault(),_self.reset()}),0!=options.buttonDel&&$(tools).append(del),$(element).append(tools)}_self.options.onAfterInitImage&&_self.options.onAfterInitImage.call(_self,_self)},_bind:function(){var _self=this,element=_self.element,input=_self.input;$(element).unbind("dragover drop mouseout").on({dragover:function(event){_self.handleDrag(event)},drop:function(event){_self.handleFile(event,$(this))},mouseout:function(){$(document).unbind("mouseup touchend").on("mouseup touchend",function(e){e.preventDefault(),_self.imageUnhandle()})}}),$(input).unbind("change").change(function(event){_self.drag=!1,_self.handleFile(event,$(element))})},toggleDropzoneClass:function(state){var element=this.element;$(element).toggleClass("no-image",state||!1)},handleFile:function(event,element){event.stopPropagation(),event.preventDefault();var _self=this,files=(this.options,0==_self.drag?event.originalEvent.target.files:event.originalEvent.dataTransfer.files);_self.drag=!1,$(element).removeClass("notAnImage").addClass("loading");for(var f,i=0;f=files[i];i++)if(f.type.match("image.*")){var reader=new FileReader;reader.onload=function(theFile){return function(e){$(element).find("img").remove(),_self.readImage(reader.result,e.target.result,theFile.name,theFile.type)}}(f),reader.readAsDataURL(f)}else $(element).addClass("notAnImage");_self.options.onAfterSelectImage&&_self.options.onAfterSelectImage.call(_self,response,_self)},readImage:function(image,src,name,mimeType){var _self=this,options=this.options,element=this.element;_self.drag=!1;var img=new Image;img.onload=function(tmp){var width,height,useWidth,useHeight,ratio,elementRatio,imgElement=$('<img src="'+src+'" name="'+name+'" />');ratio=(width=useWidth=img.width)/(height=useHeight=img.height),elementRatio=$(element).outerWidth()/$(element).outerHeight(),0==options.originalsize?(useHeight=(useWidth=$(element).outerWidth()+40)/ratio)<$(element).outerHeight()&&(useWidth=(useHeight=$(element).outerHeight()+40)*ratio):(useWidth<$(element).outerWidth()||useHeight<$(element).outerHeight())&&(1==options.smaller||(ratio<elementRatio?useHeight=(useWidth=$(element).outerWidth())/ratio:useWidth=(useHeight=$(element).outerHeight())*ratio));var left=parseFloat(($(element).outerWidth()-useWidth)/2),top=parseFloat(($(element).outerHeight()-useHeight)/2);imgElement.css({left:left,top:top,width:useWidth,height:useHeight}),_self.image=$(imgElement).clone().data({mime:mimeType,width:width,height:height,ratio:ratio,left:left,top:top,useWidth:useWidth,useHeight:useHeight}).addClass("main").bind("mousedown touchstart",function(event){_self.imageHandle(event)}),_self.imageGhost=options.ghost?$(imgElement).addClass("ghost"):null,$(element).append($('<div class="cropWrapper"></div>').append($(_self.image))),empty(_self.imageGhost)||$(element).append(_self.imageGhost),_self._tools(),_self.toggleDropzoneClass(!1),$(element).removeClass("loading")},img.src=image},handleDrag:function(event){this.drag=!0,event.stopPropagation(),event.preventDefault(),event.originalEvent.dataTransfer.dropEffect="copy"},imageHandle:function(e){e.preventDefault();var event=e.originalEvent.touches||e.originalEvent.changedTouches?e.originalEvent.touches[0]||e.originalEvent.changedTouches[0]:e,_self=this,element=this.element,image=this.image,options=this.options,height=image.outerHeight(),width=image.outerWidth(),cursor_y=image.offset().top+height-event.pageY,cursor_x=image.offset().left+width-event.pageX;$(document).on({"dragstart mousemove touchmove":function(e){$("body").css({cursor:"move"}),e.stopImmediatePropagation(),e.preventDefault();var event=e.originalEvent.touches||e.originalEvent.changedTouches?e.originalEvent.touches[0]||e.originalEvent.changedTouches[0]:e,imgTop=event.pageY+cursor_y-height,imgLeft=event.pageX+cursor_x-width,hasBorder=$(element).outerWidth()!=$(element).innerWidth();0==options.smaller&&(parseInt(imgTop-$(element).offset().top)>0?imgTop=$(element).offset().top+(hasBorder?1:0):imgTop+height<$(element).offset().top+$(element).outerHeight()&&(imgTop=$(element).offset().top+$(element).outerHeight()-height+(hasBorder?1:0)),parseInt(imgLeft-$(element).offset().left)>0?imgLeft=$(element).offset().left+(hasBorder?1:0):imgLeft+width<$(element).offset().left+$(element).outerWidth()&&(imgLeft=$(element).offset().left+$(element).outerWidth()-width+(hasBorder?1:0))),image.offset({top:imgTop,left:imgLeft}),_self._ghost()},"dragend mouseup touchend":function(){_self.imageUnhandle()}})},imageUnhandle:function(){this.image;$(document).unbind("mousemove touchmove"),$("body").css({cursor:""}),this.options.onAfterMoveImage&&this.options.onAfterMoveImage.call(this,this)},imageZoom:function(x){var element=this.element,image=this.image,options=this.options;if(empty(image))return this._clearTimers(),!1;var ratio=image.data("ratio"),newWidth=image.outerWidth()+x,newHeight=newWidth/ratio;0==options.smaller?(newWidth<$(element).outerWidth()&&(newHeight=(newWidth=$(element).outerWidth())/ratio),newHeight<$(element).outerHeight()&&(newWidth=(newHeight=$(element).outerHeight())*ratio)):(newWidth<1||newHeight<1)&&(newWidth>newHeight?newHeight=(newWidth=1)/ratio:newWidth=(newHeight=1)*ratio);var newTop=image.css("top").replace(/[^-\d\.]/g,"")-(newHeight-image.outerHeight())/2,newLeft=image.css("left").replace(/[^-\d\.]/g,"")-(newWidth-image.outerWidth())/2;0==options.smaller&&($(element).offset().left-newLeft<$(element).offset().left?newLeft=0:$(element).outerWidth()>newLeft+$(image).outerWidth()&&x<=0&&(newLeft=$(element).outerWidth()-newWidth),$(element).offset().top-newTop<$(element).offset().top?newTop=0:$(element).outerHeight()>newTop+$(image).outerHeight()&&x<=0&&(newTop=$(element).outerHeight()-newHeight)),image.css({width:newWidth,height:newHeight,top:newTop,left:newLeft}),this._ghost()},imageCrop:function(){var finalWidth,finalHeight,finalTop,finalLeft,imageWidth,imageHeight,imageOriginalWidth,imageOriginalHeight,_self=this,element=_self.element,image=_self.image,input=_self.input,options=_self.options,factor=options.width!=$(element).outerWidth()?options.width/$(element).outerWidth():1;finalWidth=options.width,finalHeight=options.height,finalTop=parseInt(Math.round(parseInt($(image).css("top"))*factor)),finalLeft=parseInt(Math.round(parseInt($(image).css("left"))*factor)),imageWidth=parseInt(Math.round($(image).width()*factor)),imageHeight=parseInt(Math.round($(image).height()*factor)),imageOriginalWidth=$(image).data("width"),imageOriginalHeight=$(image).data("height"),finalTop=finalTop||0,finalLeft=finalLeft||0;var obj={name:$(image).attr("name"),imageOriginalWidth:imageOriginalWidth,imageOriginalHeight:imageOriginalHeight,imageWidth:imageWidth,imageHeight:imageHeight,width:finalWidth,height:finalHeight,left:finalLeft,top:finalTop};if($(element).find(".tools").children().toggle(),$(element).find(".tools").append($(_self.button.saving)),1==options.canvas){var canvas=$('<canvas class="final" id="canvas_'+$(input).attr("name")+'" width="'+finalWidth+'" height="'+finalHeight+'" style="position:absolute; top: 0; bottom: 0; left: 0; right: 0; z-index:100; width: 100%; height: 100%;"></canvas>');$(element).append(canvas);var canvasContext=$(canvas)[0].getContext("2d"),imageObj=new Image;imageObj.onload=function(){var canvasTmp=$('<canvas width="'+imageWidth+'" height="'+imageHeight+'"></canvas>'),canvasTmpContext=$(canvasTmp)[0].getContext("2d");$('<img src="" />');canvasTmpContext.drawImage(imageObj,0,0,imageWidth,imageHeight);var tmpObj=new Image;tmpObj.onload=function(){if(1==options.canvasImageOnly){var _imageWidth=imageWidth,_imageHeight=imageHeight;finalLeft<0?_imageWidth+=finalLeft:finalLeft+imageWidth>finalWidth&&(_imageWidth=finalWidth-finalLeft),finalTop<0?_imageHeight+=finalTop:finalTop+imageHeight>finalHeight&&(_imageHeight=finalHeight-finalTop);var canvasImageOnly=$('<canvas width="'+_imageWidth+'" height="'+_imageHeight+'"></canvas>');$(canvasImageOnly)[0].getContext("2d").drawImage(tmpObj,finalLeft<0?finalLeft:0,finalTop<0?finalTop:0,imageWidth,imageHeight)}imageWidth<finalWidth||imageHeight<finalHeight?canvasContext.drawImage(tmpObj,finalLeft,finalTop,imageWidth,imageHeight):canvasContext.drawImage(tmpObj,-1*finalLeft,-1*finalTop,finalWidth,finalHeight,0,0,finalWidth,finalHeight);var dataUrl=1==options.canvasImageOnly?$(canvasImageOnly)[0].toDataURL(image.data("mime")):$(canvas)[0].toDataURL(image.data("mime"));if(0==options.save)$(element).find(".tools .saving").remove(),$(element).find(".tools").children().toggle(),_self.options.onSave&&_self.options.onSave.call(_self,$.extend(obj,options.data,{data:dataUrl})),_self.imageFinal();else if(1==options.ajax)_self._ajax($.extend({data:dataUrl},obj));else{var json=JSON.stringify($.extend({data:dataUrl},obj));$(input).after($('<input type="text" name="'+$(input).attr("name")+'_values" class="final" />').val(json)),$(input).data("required",$(input).prop("required")),$(input).prop("required",!1),$(input).wrap("<form>").parent("form").trigger("reset"),$(input).unwrap(),$(element).find(".tools .saving").remove(),$(element).find(".tools").children().toggle(),_self.imageFinal()}},tmpObj.src=$(canvasTmp)[0].toDataURL(image.data("mime"))},imageObj.src=$(image).attr("src"),!0===options.saveOriginal&&(obj=$.extend({original:$(image).attr("src")},obj))}else if(1==options.ajax)_self._ajax($.extend({data:$(image).attr("src"),saveOriginal:options.saveOriginal},obj));else{var finalImage=$(element).find(".cropWrapper").clone();$(finalImage).addClass("final").show().unbind().children().unbind(),$(element).append($(finalImage)),_self.imageFinal();var json=JSON.stringify(obj);$(input).after($('<input type="text" name="'+$(input).attr("name")+'_values" class="final" />').val(json))}},_ajax:function(obj){var _self=this,element=_self.element,options=(_self.image,_self.options);1==options.dimensionsonly&&delete obj.data,$.ajax({type:"POST",url:options.url,data:$.extend(obj,options.data),success:function(response){$(element).find(".tools .saving").remove(),$(element).find(".tools").children().toggle(),_self.from_server=response,$(element).data("name",response.image).addClass("image-exists"),$(element).data("filename",response.filename),options.canvas||$(element).append($('<img src="'+response.image+'" class="final" style="width: 100%" />')),_self.imageFinal()},error:function(response,status){$(element).find(".tools .saving").remove(),$(element).find(".tools").children().toggle(),_self.onAjaxError(response,_self.responseReset)}})},imageReset:function(){var image=this.image;this.element;$(image).css({width:image.data("useWidth"),height:image.data("useHeight"),top:image.data("top"),left:image.data("left")}),this._ghost(),this.options.onAfterResetImage&&this.options.onAfterResetImage.call(this,this)},imageFinal:function(){var _self=this,element=_self.element,input=_self.input,options=_self.options;$(element).addClass("done"),$(element).children().not(".final").hide();var tools=$('<div class="tools final">');if(0!=options.buttonEdit&&$(tools).append($(_self.button.edit).click(function(){$(element).children().show(),$(element).find(".final").remove(),$(input).data("valid",!1)})),0!=options.buttonDel&&$(tools).append($(_self.button.del).click(function(e){_self.reset()})),$(element).append(tools),$(element).unbind(),1==options.download){var download=$('<div class="download final"/>');$(download).append($(_self.button.download).attr("download",$(_self.image).attr("name")).click(function(e){$(this).attr("href",$(element).find("canvas.final")[0].toDataURL(_self.image.data("mime")))})),$(element).append(download)}$(input).unbind().data("valid",!0),_self.options.onAfterUploadImage&&_self.options.onAfterUploadImage.call(_self,_self)},responseReset:function(){var element=this.element;$(element).find(".alert").remove()},onAjaxError:function(response,callback){"onError"in options?options.onError(response):error instanceof Error&&UTILS.Errors.show(error.message),_.isFunction(callback)&&callback.delay(2e3)},imageRemove:function(){var _self=this;_.isPlainObject(_self.options.removeurl)&&"url"in _self.options.removeurl&&$.ajax({type:"POST",url:_self.options.removeurl.url,data:_self.options.removeurl.data||{},success:function(response){$(_self.element).data("name",null).removeClass("image-exists"),_self.options.onAfterRemoveImage&&_self.options.onAfterRemoveImage.call(_self,response,_self)},error:_self.onAjaxError})},reset:function(){var element=this.element,input=this.input,options=this.options;this.image=null,$(element).find(".preview").remove(),$(element).removeClass("loading done").children().show().not("input[type=file]").remove(),$(input).wrap("<form>").parent("form").trigger("reset"),$(input).unwrap(),$(input).prop("required",$(input).data("required")||options.required||!1).data("valid",!1),this._bind(),$(element).data("name")&&this.imageRemove(),this.imageGhost&&($(this.imageGhost).remove(),this.imageGhost=null),this.toggleDropzoneClass(!0),this.options.onAfterCancel&&this.options.onAfterCancel.call(this)},resize:function(){var options=this.options,element=this.element,image=this.image;if(!0!==options.resize)return!1;var oldWidth=$(element).outerWidth(),width=$(element).offsetParent().width()*(this.widthPercentage/100),factor=width/oldWidth,height=$(element).outerHeight()*factor;return $(element).css({height:height,width:width}),width<240?$(element).hasClass("smalltools smalltext")||$(element).addClass("smalltools smalltext smalladded"):$(element).hasClass("smalladded")&&$(element).removeClass("smalltools smalltext smalladded"),empty(image)||($(image).css({left:$(image).css("left").replace(/[^-\d\.]/g,"")*factor+"px",top:$(image).css("top").replace(/[^-\d\.]/g,"")*factor+"px"}),$(image).width($(image).width()*factor),$(image).height($(image).height()*factor),this._ghost()),!0},reinit:function(){this.element;return this.resize(),this._bind(),!0},modal:function(){var element=this.element;return $(element).attr("style",$(element).data("style")),$(element).attr("class",$(element).data("class")),this._init(),this},_ghost:function(){var options=this.options,image=this.image,ghost=this.imageGhost;1!=options.ghost||empty(ghost)||$(ghost).css({width:image.css("width"),height:image.css("height"),top:image.css("top"),left:image.css("left")})},_tools:function(){var _self=this,element=_self.element,tools=$('<div class="tools"></div>'),options=_self.options;0!=options.buttonZoomin&&$(tools).append($(_self.button.zoomin).on({"touchstart mousedown":function(e){e.preventDefault(),_self.interval=window.setInterval(function(){_self.imageZoom(2)},1)},"touchend mouseup mouseleave":function(e){e.preventDefault(),window.clearInterval(_self.interval),_self.options.onAfterZoomImage&&_self.options.onAfterZoomImage.call(_self,_self)}})),0!=options.buttonZoomreset&&$(tools).append($(_self.button.zoomreset).on({"touchstart click":function(e){e.preventDefault(),_self.imageReset()}})),0!=options.buttonZoomout&&$(tools).append($(_self.button.zoomout).on({"touchstart mousedown":function(e){e.preventDefault(),_self.interval=window.setInterval(function(){_self.imageZoom(-2)},1)},"touchend mouseup mouseleave":function(e){e.preventDefault(),window.clearInterval(_self.interval),_self.options.onAfterZoomImage&&_self.options.onAfterZoomImage.call(_self,_self)}})),0!=options.buttonCancel&&$(tools).append($(_self.button.cancel).on({"touchstart touchend click":function(e){e.preventDefault(),_self.reset()}})),0!=options.buttonDone&&$(tools).append($(_self.button.done).on({"touchstart click":function(e){e.preventDefault(),_self.imageCrop()}})),$(element).append($(tools))},_clearTimers:function(){for(var interval_id=window.setInterval("",9999),i=1;i<interval_id;i++)window.clearInterval(i)},_formValidation:function(){var element=this.element;this.input;$(element).closest("form").submit(function(e){return $(this).find("input[type=file]").each(function(i,el){if($(el).prop("required")&&!0!==$(el).data("valid"))return e.preventDefault(),!1}),!0})}},$.fn.imageUploader=function(options){if(!$.data(this,"image-uploader"))return $(this).each(function(){$.data(this,"image-uploader",new $.imageUploader(options,this))})}}(window,jQuery);