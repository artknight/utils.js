UTILS.Box=class extends UTILS.Base{constructor(data={}){super(data),"onCreate"in data&&this.addCallback("onCreate",data.onCreate),"onShow"in data&&this.addCallback("onShow",data.onShow),"onHide"in data&&this.addCallback("onHide",data.onHide),"onBlur"in data&&this.addCallback("onBlur",data.onBlur),"onUnblur"in data&&this.addCallback("onUnblur",data.onUnblur),"onStart"in data&&this.addCallback("onStart",data.onStart),"onBeforeStart"in data&&this.addCallback("onBeforeStart",data.onBeforeStart),"onBeforeShow"in data&&this.addCallback("onBeforeShow",data.onBeforeShow),"onComplete"in data&&this.addCallback("onComplete",data.onComplete),"onMaximize"in data&&this.addCallback("onMaximize",data.onMaximize),"onMinimize"in data&&this.addCallback("onMinimize",data.onMinimize),"onClose"in data&&this.addCallback("onClose",data.onClose),"onCancel"in data&&this.addCallback("onCancel",data.onCancel),"onBeforeClose"in data&&this.addCallback("onBeforeClose",data.onBeforeClose),"onCreate"in data&&this.addCallback("onCreate",data.onCreate),"onContentHeightChange"in data&&this.addCallback("onContentHeightChange",data.onContentHeightChange),"onContentUpdate"in data&&this.addCallback("onContentUpdate",data.onContentUpdate),this.values.max_responsive_width="w"in data&&768<data.w?data.w:768,"resizeDims"in data&&(data.fixed_dims=data.resizeDims),"max_width"in data&&this.setMaxWidthForFixedDims(data.max_width),"max_height"in data&&this.setMaxHeightForFixedDims(data.max_height);var _data={w:data.w||600,h:data.h||"auto",html:data.html||"",light:!!data.light,title:data.title||"",controls:data.controls||"",classname:data.classname||"",buttons:data.buttons||null,coords:data.coords||null,center:!!data.center,offset:data.offset&&"object"==typeof data.offset?data.offset:{left:0,top:0},freeze:!!data.freeze,blur:data.blur||null,dimmer:data.dimmer||!1,scrollable:data.scrollable||!1,fixed_dims:"number"==typeof data.fixed_dims||"string"==typeof data.fixed_dims?data.fixed_dims:null};return this._create().set(_data),"allow_close"in data&&this.setAllowCloseState(data.allow_close),data.outside_close=!("outside_close"in data)||data.outside_close,this.setCloseOnOutsideClickState(data.outside_close),this}getDefaults(){return{object:"utils.box",version:"3.5.0",history:{},is_shown:!1,$elm:null,divs:{scrolling_wrapper:null},html:"",num_of_opens:0,light:!1,fx:{effect:null,base:null},blur:{color:"black"},__blur:null,buttons:{close:!0,maximize:!1},is_close_allowed:!0,outside_close:!1,max_width_for_fixed_dims:null,max_height_for_fixed_dims:null}}setTarget(target){return target&&(super.setTarget(target),target instanceof UTILS.Box&&(this.values.$target=target)),this}getBlur(){return this.values.__blur}setBlur(__blur){return this.values.__blur=__blur,this}destroy(){this.values.$elm.remove()}clean(){return $(document).off("keyup.escape.utils.box",this._onEscapeKeyPressed),this.fns("onBeforeClose"),this.cleanAfterMaximize(),this.values.is_shown=!1,null!=this.values.fx.effect?this.fx("close"):(this.destroy(),this.fns("onClose")),this}show(){this.fns("onBeforeShow"),this.values.num_of_opens++,1==this.values.num_of_opens&&this.fns("onBeforeStart");let _show=()=>{null!=this.values.fx.effect&&1==this.values.num_of_opens?this.fx("open"):(this.values.$elm.show().css("visibility","visible"),1==this.values.num_of_opens&&(this.fns("onStart"),this.fns("onComplete")),this.fns("onShow")),this.values.is_shown=!0};if(this.values.scrollable&&this.enableScrolling(),this.values.dimmer){let _onClose=()=>{};if(this.values.$target instanceof UTILS.Box)_onClose=this.values.$target.unblur.bind(this.values.$target),this.values.$target.blur(),_show(),this.getTargetDOM().append(this.values.$elm);else{let $target=this.isGlobalBox()?$("body"):this.values.$target,__blur=new UTILS.Blur({target:$target,color:"black",onShow:__blur=>{this.isGlobalBox()&&$("body").addClass("overflow global-dimmer"),_show()},onHide:__blur=>{this.isGlobalBox()&&$("body").removeClass("overflow global-dimmer")}});this.setBlur(__blur),_onClose=this instanceof APP.Box&&1<APP.stack.getBoxes().length?()=>{}:__blur.hide.bind(__blur),this.isCloseOnOutsideClick()&&__blur.getBlur().one("click",event=>{event.preventDefault(),this.clean()}),__blur.show()}this.set({onClose:_onClose})}else _show();return this}hide(){return this.values.$elm.hide(),this.fns("onHide"),this.values.is_shown=!1,this}isShown(){return this.values.is_shown}isGlobalBox(){return!(this.values.$target instanceof UTILS.Box)&&this.values.$target.is("body")}isInsideBox(){return this.getParentBox().length}isMaximized(){return this.values.$elm.hasClass("maximized")}enableScrolling(){"scrollable"in this.values.history||this.isInsideBox()||this.isMaximized()||(this.values.history.scrollable={coords:this.values.coords,freeze:this.values.freeze,classes:this.values.$elm.attr("class").match(/(?:^|)pos-(\w+)(?!\w)/g)||[]},this.set({coords:{left:"auto",top:0},freeze:!1,onBeforeClose:this.disableScrolling.bind(this)},!0),this.values.divs.$scrolling_wrapper=this.values.$elm.wrap($("<div>",{class:"box-scrollable"})).parent(),this.values.$elm.removeClass("pos-fixed pos-absolute").addClass("cfx"),this.values.dimmer||$("body").addClass("overflow"))}disableScrolling(){"scrollable"in this.values.history&&(this.set({coords:this.values.history.scrollable.coords,freeze:this.values.history.scrollable.freeze,scrollable:!1},!0),this.values.divs.$scrolling_wrapper&&this.values.divs.$scrolling_wrapper.length&&this.values.divs.$scrolling_wrapper.after(this.values.$elm).remove(),this.values.dimmer||$("body").removeClass("overflow"),this.values.history.scrollable.classes.length&&(this.values.$elm.removeClass("pos-fixed pos-absolute"),this.values.$elm.addClass(UTILS.joinArray(this.values.history.scrollable.classes," ")),this.values.center&&this.setCenter()),delete this.values.history.scrollable)}maximize(){switch(this.values.$elm.hasClass("maximized")){case!1:this.values.fixed_dims?this.values.history.fixed_dims=this.values.fixed_dims:this.values.history.on_static={w:this.values.w,h:this.values.h,coords:this.values.$elm.offset()},this.set({fixed_dims:0}),$("body").addClass("overflow"),this.values.divs.$maximize.attr({title:"minimize"}),this.values.$elm.addClass("maximized"),this.fns("onMaximize");break;case!0:"fixed_dims"in this.values.history?(this.set({fixed_dims:UTILS.joinArray(this.values.history.fixed_dims,"x")}),delete this.values.history.fixed_dims):"on_static"in this.values.history&&(this.set({w:this.values.history.on_static.w,h:this.values.history.on_static.h,coords:this.values.history.on_static.coords}),delete this.values.history.on_static,this.values.fixed_dims=null),this.cleanAfterMaximize(),this.values.divs.$maximize.attr({title:"maximize"}),this.values.$elm.removeClass("maximized"),this.fns("onMinimize")}}cleanAfterMaximize(){1!=$(".box.maximized","body").length||$("body").hasClass("global-dimmer")||$("body").removeClass("overflow")}boxExists(){return!!$(this.values.$elm).length}blur(){var blur_instance=this.values.$elm.data("utils.blur");return(blur_instance=blur_instance instanceof UTILS.Blur?blur_instance:new UTILS.Blur({target:this.values.$elm})).set({color:this.values.blur.color,opac:this.values.blur.opac||null}).show(),this.fns("onBlur"),this}unblur(){let blur_instance=this.values.$elm.data("utils.blur");return blur_instance&&blur_instance.hide(),this.fns("onUnblur"),this}enableControls(){this.values.divs.$controls.show()}disableControls(){this.values.divs.$controls.hide()}empty(){let $mainbody=this.getMainbody();return $mainbody.empty(),this}setCenter(){let $box=this.getBox();return $box.toggleClass("box-center",this.values.center),this.isGlobalBox()||this.getTargetDOM().toggleClass("box-center-support"),this}fx(action){action=action||"open";let cssFx=function(){this.values.$elm.offset();switch(action){case"open":this.values.$elm.show().css("visibility","visible"),this.fns("onStart",this.values.$elm),UTILS.animateCss(this.values.$elm,{"fade-down":"fadeIn","slide-down":"fadeIn","slide-up":"fadeIn","slide-right":"slideInRight",shake:"shakeX","expand-in":"zoomIn"}[this.values.fx.effect]).then(elm=>{this.fns("onShow",elm),this.fns("onComplete",elm)});break;case"close":this.values.$elm.remove(),this.destroy(),this.fns("onClose")}}.bind(this),expand=function(){switch(action){case"open":this.values.$elm.show().css("visibility","visible"),this.fns("onStart",this.values.$elm),this.fns("onShow",this.values.$elm),this.fns("onComplete",this.values.$elm);break;case"close":this.values.$elm.remove(),this.destroy(),this.fns("onClose",this.values.$elm)}}.bind(this);("expand"==this.values.fx.effect?expand:cssFx)()}isCentered(){return this.values.center}getTargetDOM(){return this.values.$target instanceof UTILS.Box?this.values.$target.values.$elm:this.values.$target}getLastZIndex(){return parseInt($(".box").last().css("z-index"))+200||20001}_onBoxCloseClicked(event){event.preventDefault(),event.stopPropagation(),this.fns("onCancel"),this.clean("clean")}_create(){let zindex=this.getLastZIndex(),box_id=this.getId(),$target=this.getTargetDOM(),$elm=(this.boxExists()&&this.values.$elm.remove(),$(`
			<div id="${box_id}" class="box ${this.isGlobalBox()?"pos-fixed":"pos-absolute"} ${this.values.light?"light":""}" data-box-allow-close="${this.isCloseAllowed()}">
				<div class="box-hd">
					<div class="box-hd-title"></div>
					<div class="box-hd-extra"></div>
					<div class="box-hd-controls">
						<small class="box-timestamp text-muted"></small>
						<a href="#" title="maximize" class="box-hd-header-control box-top-buttons-maximize"><i class="ti ti-arrows-maximize"></i></a>
						<a href="#" title="close" class="box-hd-header-control box-top-buttons-close box-control-clean"><i class="ti ti-x"></i></a>
					</div>
				</div>
				<div class="box-outer">
					<div class="box-inner">
						<div class="box-mainbody"></div>
					</div>
				</div>
				<div class="box-controls"></div>
			</div>
		`));return $elm.css("zIndex",zindex),this.values.divs.$hd=$elm.find(".box-hd"),this.values.divs.$title=$elm.find(".box-hd-title"),this.values.divs.$mainbody=$elm.find(".box-mainbody"),this.values.divs.$controls=$elm.find(".box-controls"),this.values.divs.$inner=$elm.find(".box-inner"),this.values.divs.$outer=$elm.find(".box-outer"),this.values.divs.$hd_controls=$elm.find(".box-hd-controls"),this.values.divs.$hd_extra=$elm.find(".box-hd-extra"),this.values.divs.$cls=$elm.find(".box-top-buttons-close"),this.values.divs.$maximize=$elm.find(".box-top-buttons-maximize"),this.values.divs.$timestamp=$elm.find(".box-timestamp"),this.values.$elm=$elm,$target.append(this.values.$elm),new MutationObserver(()=>{this.fns("onContentUpdate")}).observe(this.values.divs.$mainbody[0],{childList:!0,subtree:!0}),this.values.$elm.on("click.clean.utils.box",".box-control-clean",this._onBoxCloseClicked.bind(this)),this.values.divs.$maximize.on("click.maximize.utils.box",this.maximize.bind(this)),$(document).on("keyup.escape.utils.box",this._onEscapeKeyPressed.bind(this)),this.values.$elm.data(this.getObjectName().split(" v")[0],this),this.fns("onCreate"),this}getMaxWidthForFixedDims(){return this.values.max_width_for_fixed_dims}setMaxWidthForFixedDims(max_width){return this.values.max_width_for_fixed_dims=max_width,this}getMaxHeightForFixedDims(){return this.values.max_height_for_fixed_dims}setMaxHeightForFixedDims(max_height){return this.values.max_height_for_fixed_dims=max_height,this}isCloseOnOutsideClick(){return this.values.outside_close}setCloseOnOutsideClickState(state=!1){return this.values.outside_close=state,this}getTimestamp(){return this.values.divs.$timestamp.html()}setTimestamp(time=""){return this.values.divs.$timestamp.html(time),this}_onEscapeKeyPressed(event){let key=UTILS.getCharKey(event),Box=$(".box").last().data("utils.box");27===key&&Box&&Box.getId()===this.getId()&&this.isCloseAllowed()&&this.clean()}isCloseAllowed(){return this.values.is_close_allowed}setAllowCloseState(state=!0){return this.values.is_close_allowed=state,this.values.$elm.attr("data-box-allow-close",state),this}set(data={}){if(data)for(var k in data)switch(!0){case/^target$/.test(k):let $target=this.getTarget();$(data[k]).get(0)!==$target.get(0)&&(this.setTarget(data[k]),this.getTargetDOM().append(this.values.$elm));break;case/^w$/.test(k):this.values.w=data[k],this.values.$elm.width(this.values.w);break;case/^h$/.test(k):this.values.h=data[k];var extra_h=this.values.divs.$controls.height();this.values.divs.$outer.height("number"==typeof this.values.h?this.values.h-extra_h:this.values.h);break;case/^title$/.test(k):this.values.$title="string"==typeof data[k]?$(`<span>${data[k]}</span>`):data[k],this.values.$title?this.values.divs.$title.html(this.values.$title).show():this.values.divs.$title.hide();break;case/^html$/.test(k):let $mainbody=this.values.divs.$mainbody;this.values.html=data[k],$mainbody.html(this.values.html);break;case/^controls$/.test(k):this.values.controls=data[k],this.values.divs.$controls.html(this.values.controls),this.values.divs.$controls.html().length?this.values.divs.$controls.addClass("expressed"):(this.values.divs.$controls.removeClass("expressed"),this.values.divs.$mainbody.css({paddingBottom:0}));break;case/^classname$/.test(k):this.values.classname=data[k],this.values.$elm.addClass(this.values.classname);break;case/^buttons$/.test(k):for(var button in UTILS.extend(this.values.buttons,data[k]),this.values.buttons)switch(button){case"close":this.setAllowCloseState(this.values.buttons.close);break;case"maximize":this.values.buttons.maximize?this.values.divs.$maximize.removeClass("hide"):this.values.divs.$maximize.addClass("hide")}break;case/^coords$/.test(k):this.values.coords=data[k],this.values.coords?this.values.$elm.css(this.values.coords):this.values.coords=null;break;case/^freeze$/.test(k):this.values.freeze=data[k],this.values.freeze?this.set({h:this.values.divs.$outer.outerHeight()+20}):this.set({h:"auto"});break;case/^center$/.test(k):this.values.center=data[k],this.setCenter();break;case/^blur$/.test(k):UTILS.extend(this.values.blur,data[k]);break;case/^dimmer$/.test(k):this.values.dimmer=!!data[k];break;case/^scrollable$/.test(k):this.values.scrollable=!!data[k];break;case/^on[A-Z][a-z].+$/.test(k):this.addCallback(k,data[k]);break;case/^fixed_dims$/.test(k):if(this.values.fixed_dims=data[k],null!==this.values.fixed_dims){let $box=this.getBox(),tmp_dims=(this.values.fixed_dims,Array.from({length:4},(_,i)=>this.values.fixed_dims));this.values.fixed_dims=[];for(let i=0;i<tmp_dims.length;i++)this.values.fixed_dims.push(parseInt(tmp_dims[i]));let max_width=this.getMaxWidthForFixedDims(),max_height=this.getMaxHeightForFixedDims();var width_on_side,height_on_side;max_width&&((extra_h=$(window).width())>max_width&&(width_on_side=(extra_h-max_width)/2,this.values.fixed_dims[3]=this.values.fixed_dims[1]=width_on_side),$(window).resize(event=>{var viewport_width=$(window).width();viewport_width>max_width&&(viewport_width=viewport_width>max_width?(viewport_width-max_width)/2:this.values.fixed_dims[0],this.getBox().css({"--box-fixed-dims-right":viewport_width+"px","--box-fixed-dims-left":viewport_width+"px"}))})),max_height&&((width_on_side=$(window).height())>max_height&&(height_on_side=(width_on_side-max_height)/2,this.values.fixed_dims[2]=this.values.fixed_dims[0]=height_on_side),$(window).resize(event=>{var viewport_height=$(window).height();viewport_height>max_height&&(viewport_height=viewport_height>max_height?(viewport_height-max_height)/2:this.values.fixed_dims[0],this.getBox().css({"--box-fixed-dims-bottom":viewport_height+"px","--box-fixed-dims-top":viewport_height+"px"}))})),$box.toggleClass("box-fixed-dims",!!this.values.fixed_dims).css({"--box-fixed-dims-top":this.values.fixed_dims[0]+"px","--box-fixed-dims-right":this.values.fixed_dims[1]+"px","--box-fixed-dims-bottom":this.values.fixed_dims[2]+"px","--box-fixed-dims-left":this.values.fixed_dims[3]+"px"})}}return this}getBox(){return this.values.$elm}getControls(){return this.values.divs.$controls}getMainbody(){return this.values.divs.$mainbody}getHeader(){return this.values.divs.$hd}getHeaderTitle(){return this.values.divs.$title}getHeaderExtra(){return this.values.divs.$hd_extra}getHeaderControls(){return this.values.divs.$hd_controls}getInner(){return this.values.divs.$inner}getOuter(){return this.values.divs.$outer}getParentBox(){return this.values.$elm.parent().closest(".box")}};