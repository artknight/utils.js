UTILS.Box=class extends UTILS.Base{constructor(data={}){super(data),_log(this.getObjectName()+" --\x3e instantiated!",this.getId(),this),"onCreate"in data&&this.addCallback("onCreate",data.onCreate),"onShow"in data&&this.addCallback("onShow",data.onShow),"onHide"in data&&this.addCallback("onHide",data.onHide),"onBlur"in data&&this.addCallback("onBlur",data.onBlur),"onUnblur"in data&&this.addCallback("onUnblur",data.onUnblur),"onStart"in data&&this.addCallback("onStart",data.onStart),"onBeforeStart"in data&&this.addCallback("onBeforeStart",data.onBeforeStart),"onComplete"in data&&this.addCallback("onComplete",data.onComplete),"onMaximize"in data&&this.addCallback("onMaximize",data.onMaximize),"onMinimize"in data&&this.addCallback("onMinimize",data.onMinimize),"onClose"in data&&this.addCallback("onClose",data.onClose),"onCancel"in data&&this.addCallback("onCancel",data.onCancel),"onBeforeClose"in data&&this.addCallback("onBeforeClose",data.onBeforeClose),"onCreate"in data&&this.addCallback("onCreate",data.onCreate),"onContentHeightChange"in data&&this.addCallback("onContentHeightChange",data.onContentHeightChange),"onContentUpdate"in data&&this.addCallback("onContentUpdate",data.onContentUpdate),this.values.max_responsive_width="w"in data&&data.w>768?data.w:768;var _data={w:data.w||600,h:data.h||"auto",html:data.html||"",light:!!data.light,title:data.title||"",controls:data.controls||"",classname:data.classname||"",buttons:data.buttons||null,dd:!!data.dd,coords:data.coords||null,center:!!data.center,offset:data.offset&&_.isPlainObject(data.offset)?data.offset:{left:0,top:0},freeze:!!data.freeze,blur:data.blur||null,dimmer:data.dimmer||!1,scrollable:data.scrollable||!1,resizeDims:data.resizeDims||null};return this.create().set(_data).enableResizeSensor(),this}getDefaults(){return{object:"utils.box",version:"3.2.6",history:{},is_shown:!1,divs:{scrolling_wrapper:null},html:"",num_of_opens:0,light:!1,fx:{effect:null,base:null},blur:{color:"black"},buttons:{close:!0,maximize:!1},resizeSensor:null}}setTarget(target){return target&&(this.values.$target=target instanceof UTILS.Box?target:$(target)),this}destroy(){this.values.$elm.remove()}clean(){return this.values.$elm.off("resize.selfcorrect.utils.box",this.selfCorrect),$(window).off("resize.utils.box resize.center.utils.box",this.onResize),$(document).off("keyup.escape.utils.box",this._onEscapeKeyPressed),this.fns("onBeforeClose"),this.cleanAfterMaximize(),null!=this.values.fx.effect?this.fx("close"):(this.destroy(),this.fns("onClose")),this}show(){this.values.num_of_opens++,1==this.values.num_of_opens&&this.fns("onBeforeStart");var _show=function(){null!=this.values.fx.effect&&1==this.values.num_of_opens?this.fx("open"):(this.values.$elm.show().css("visibility","visible"),1==this.values.num_of_opens&&(this.fns("onStart"),this.fns("onComplete")),this.fns("onShow")),this.values.is_shown=!0}.bind(this);if(this.values.scrollable&&this.enableScrolling(),this.values.dimmer){var onClose=new Function;if(this.isGlobalBox())onClose=this instanceof APP.Box&&APP.stack.getBoxes().length>1?new Function:UTILS.dim.hide,UTILS.dim.show(null,{onShow:_show});else if(this.values.$target instanceof UTILS.Box)onClose=this.values.$target.unblur.bind(this.values.$target),this.values.$target.blur(),_show(),this.getTargetDOM().append(this.values.$elm);else{var blur=new UTILS.Blur({target:this.values.$target,color:this instanceof APP.Confirm?"black":"white",onShow:_show});onClose=blur.hide.bind(blur),blur.show()}this.set({onClose:onClose},!0)}else _show();return this}hide(){return this.values.$elm.hide(),this.fns("onHide"),this.values.is_shown=!1,this}isGlobalBox(){return!(this.values.$target instanceof UTILS.Box)&&this.values.$target.is("body")}isInsideBox(){return this.getParentBox().length}isMaximized(){return this.values.$elm.hasClass("maximized")}enableScrolling(){"scrollable"in this.values.history||this.isInsideBox()||this.isMaximized()||(this.values.history.scrollable={coords:this.values.coords,freeze:this.values.freeze,classes:this.values.$elm.attr("class").match(/(?:^|)pos-(\w+)(?!\w)/g)||[]},this.set({coords:{left:"auto",top:0},freeze:!1,onBeforeClose:this.disableScrolling.bind(this)},!0),this.values.divs.$scrolling_wrapper=this.values.$elm.wrap($("<div>",{class:"box-scrollable"})).parent(),this.values.$elm.removeClass("pos-fixed pos-absolute").addClass("cfx"),this.values.dimmer||$("body").addClass("overflow"))}disableScrolling(){"scrollable"in this.values.history&&(this.set({coords:this.values.history.scrollable.coords,freeze:this.values.history.scrollable.freeze,scrollable:!1},!0),this.values.divs.$scrolling_wrapper&&this.values.divs.$scrolling_wrapper.length&&this.values.divs.$scrolling_wrapper.after(this.values.$elm).remove(),this.values.dimmer||$("body").removeClass("overflow"),this.values.history.scrollable.classes.length&&(this.values.$elm.removeClass("pos-fixed pos-absolute"),this.values.$elm.addClass(_.joinArray(this.values.history.scrollable.classes," ")),this.values.center&&this.values.$elm.setCenter(this.values.offset,this.isGlobalBox()?$(window):this.getTargetDOM())),delete this.values.history.scrollable)}maximize(){switch(this.values.$elm.hasClass("maximized")){case!1:this.values.resizeDims?this.values.history.resizeDims=this.values.resizeDims:this.values.history.on_static={w:this.values.w,h:this.values.h,coords:this.values.$elm.offset()},this.set({resizeDims:0}),$("body").addClass("overflow"),this.values.divs.$maximize.attr({title:"minimize"}),this.values.$elm.addClass("maximized"),this.fns("onMaximize");break;case!0:"resizeDims"in this.values.history?(this.set({resizeDims:_.joinArray(this.values.history.resizeDims,"x")}),delete this.values.history.resizeDims):"on_static"in this.values.history&&(this.set({w:this.values.history.on_static.w,h:this.values.history.on_static.h,coords:this.values.history.on_static.coords}),delete this.values.history.on_static,this.values.resizeDims=null,this.values.divs.$mainbody.height("auto"),$(window).off("resize.utils.box",this.onResize)),this.cleanAfterMaximize(),this.values.divs.$maximize.attr({title:"maximize"}),this.values.$elm.removeClass("maximized"),this.fns("onMinimize")}}cleanAfterMaximize(){1!=$(".box.maximized","body").length||$("body").hasClass("global-dimmer")||$("body").removeClass("overflow")}boxExists(){return!!$(this.values.$elm).length}getBox(){return this.values.$elm}blur(){var blur_instance=this.values.$elm.data("utils.blur");return blur_instance instanceof UTILS.Blur||(blur_instance=new UTILS.Blur({target:this.values.$elm})),blur_instance.set({color:this.values.blur.color,opac:this.values.blur.opac||null}).show(),this.fns("onBlur"),this}unblur(){var blur_instance=this.values.$elm.data("utils.blur");return blur_instance&&blur_instance.hide(),this.fns("onUnblur"),this}enableControls(){this.values.divs.$controls.show()}disableControls(){this.values.divs.$controls.hide()}empty(){var $mainbody=this.getMainbody(),$sensor=$mainbody.find(".resize-sensor");return $mainbody.empty(),$sensor.length&&$mainbody.append($sensor),this}onResize(){var $parent=this.isGlobalBox()?$(window):this.getTargetDOM(),page_w=$parent.width(),page_h=$parent.height(),dims={w:page_w-(this.values.resizeDims[1]+this.values.resizeDims[3]),h:page_h-(this.values.resizeDims[0]+this.values.resizeDims[2]),left:this.values.resizeDims[3],top:this.values.resizeDims[0]};this.values.center&&"responsive"in this.values.history&&(dims.h="auto",dims.w-=20,dims.left=this.isInsideBox()?20:"auto",this.enableScrolling()),this.set({w:dims.w,h:dims.h,coords:{left:dims.left,top:dims.top}},!0)}onCenter(){if($(window).width()<this.values.max_responsive_width)"responsive"in this.values.history||(this.values.history.responsive={resizeDims:this.values.resizeDims,w:this.values.w,h:this.values.h,coords:this.values.coords}),this.values.resizeDims=[20,20,20,20],this.onResize();else{var $parent=this.isGlobalBox()?$(window):this.getTargetDOM();"responsive"in this.values.history&&(this.values.resizeDims=this.values.history.responsive.resizeDims,this.set({w:this.values.history.responsive.w,h:this.values.history.responsive.h,coords:this.values.history.responsive.coords}),delete this.values.history.responsive),this.values.$elm.setCenter(this.values.offset,$parent),$parent.height()<this.values.$elm.outerHeight()?(this.values.$elm.css({top:0}),this.enableScrolling()):this.disableScrolling()}}fx(action){action=action||"open";var cssFx=function(){this.values.$elm.offset();switch(action){case"open":this.values.$elm.velocity({"fade-up":"transition.slideUpIn","fade-down":"transition.slideDownIn","fade-left":"transition.slideLeftIn","fade-right":"transition.slideRightIn","slide-down":"transition.slideDownBigIn","slide-up":"transition.slideUpBigIn","slide-left":"transition.slideLeftBigIn","slide-right":"transition.slideRightBigIn",shake:"callout.shake","fade-in":"transition.fadeIn","fade-out":"transition.fadeOut","zoom-in":"transition.shrinkIn","zoom-out":"transition.shrinkOut","expand-in":"transition.expandIn","expand-out":"transition.expandOut","bounce-up":"transition.bounceUpIn","bounce-down":"transition.bounceDownIn","bounce-left":"transition.bounceLeftIn","bounce-right":"transition.bounceRightIn"}[this.values.fx.effect],{duration:500,begin:function(elms){this.values.$elm.show().css("visibility","visible"),this.fns("onStart",elms)}.bind(this),complete:function(elms){this.fns("onShow",elms),this.fns("onComplete",elms)}.bind(this)});break;case"close":this.values.$elm.velocity("reverse",{complete:function(elms){this.destroy(),this.fns("onClose")}.bind(this)})}}.bind(this),expand=function(){switch(action){case"open":if(this.values.fx.base.length){this.values.coords||this.set({center:!0},!0);var size={start:{w:this.values.fx.base.outerWidth(),h:this.values.fx.base.outerHeight()},end:{w:this.values.$elm.outerWidth(),h:this.values.$elm.outerHeight()}},coords={start:this.isGlobalBox()?this.values.fx.base.offset():this.values.fx.base.position(),end:this.isGlobalBox()?this.values.$elm.offset():this.values.$elm.position()};this.values.$elm.velocity({height:[size.end.h,size.start.h],width:[size.end.w,size.start.w],left:[coords.end.left,coords.start.left],top:[coords.end.top,coords.start.top],opacity:[1,.1]},{duration:400,begin:function(elm){this.values.divs.$outer.hide(),this.values.$elm.addClass("overflow"),this.values.$elm.show().css("visibility","visible"),this.fns("onStart",elm)}.bind(this),complete:function(elms){this.values.$elm.removeClass("overflow"),this.values.divs.$outer.show(),this.values.$elm.css({width:"auto",height:"auto"}),this.fns("onShow",elms),this.fns("onComplete",elms)}.bind(this)})}else UTILS.Errors.show("@base must be specified.");break;case"close":this.values.$elm.velocity("reverse",{begin:function(elms){this.values.divs.$outer.hide(),this.values.$elm.addClass("overflow")}.bind(this),complete:function(elms){this.destroy(),this.fns("onClose",elms)}.bind(this)})}}.bind(this);"expand"==this.values.fx.effect?expand():cssFx()}isCentered(){return this.values.center}enableResizeSensor(){return this.isCentered()&&!this.values.resizeSensor&&(_log(this.getObjectName()+" --\x3e resize sensor enabled",this.getId()),this.values.resizeSensor=new ResizeSensor(this.getMainbody(),function(){this.fns("onContentHeightChange",{height:this.getMainbody().height()})}.bind(this))),this}disableResizeSensor(){return this.values.resizeSensor&&(_log(this.getObjectName()+" --\x3e resize sensor disabled",this.getId()),this.values.resizeSensor.detach(this.getMainbody())),this}selfCorrect(){var m=parseInt(this.values.divs.$mainbody.css("marginTop").replace(/\D/g,"")),p=parseInt(this.values.divs.$inner.css("paddingTop").replace(/\D/g,"")),h=this.values.divs.$controls.html().length?this.values.divs.$controls.outerHeight():0;null!=this.values.resizeDims?this.values.divs.$mainbody.height(this.values.divs.$outer.outerHeight()-h-p-m):this.values.divs.$mainbody.height("auto"),this.values.divs.$controls.width(this.values.divs.$outer.outerWidth()-20)}getTargetDOM(){return this.values.$target instanceof UTILS.Box?this.values.$target.values.$elm:this.values.$target}getLastZIndex(){return parseInt($(".box").last().css("z-index"))+200||20001}create(){var zindex=this.getLastZIndex();return this.boxExists()&&$("#"+this.values.id).remove(),this.values.$elm=$('<div id="'+this.values.id+'" class="box '+(this.isGlobalBox()?"pos-fixed":"pos-absolute")+" "+(this.values.light?" light":"")+'" style="z-index:'+zindex+'">'),this.values.divs.$hd=$('<div id="'+this.values.id+'-box-hd" class="box-hd">'),this.values.divs.$mainbody=$('<div id="'+this.values.id+'-box-mainbody" class="box-mainbody cfx">'),this.values.divs.$controls=$('<div id="'+this.values.id+'-box-controls" class="box-controls cfx" style="z-index:'+parseInt(zindex+4)+'">'),this.values.divs.$inner=$('<div id="'+this.values.id+'-box-inner" class="box-inner">'),this.values.divs.$outer=$('<div id="'+this.values.id+'-box-outer" class="box-outer">'),this.values.divs.$buttons=$('<div id="'+this.values.id+'-box-top-buttons" class="box-top-buttons">'),this.values.divs.$cls=$('<a id="'+this.values.id+'-box-boxcls" href="#" title="close" class="box-top-buttons-close"><i class="mdi mdi-close mdi-fw mdi-24px"></i></a>'),this.values.divs.$maximize=$('<a id="'+this.values.id+'-box-maximize" href="#" title="maximize" class="box-top-buttons-maximize"><i class="mdi mdi-arrow-expand-all mdi-fw mdi-24px"></i></a>'),this.getTargetDOM().append(this.values.$elm.append(this.values.divs.$outer.append(this.values.divs.$inner.append(this.values.divs.$hd,this.values.divs.$mainbody),this.values.divs.$buttons.append(this.values.divs.$maximize,this.values.divs.$cls)),this.values.divs.$controls)),this.values.divs.$cls.on("click.clean.utils.box",function(event){event.preventDefault(),event.stopPropagation(),this.fns("onCancel"),this.clean("clean")}.bind(this)),this.values.divs.$maximize.on("click.maximize.utils.box",this.maximize.bind(this)),this.values.$elm.on("resize.selfcorrect.utils.box",this.selfCorrect.bind(this)),$(document).on("keyup.escape.utils.box",this._onEscapeKeyPressed.bind(this)),this.values.$elm.data("box",this),this.fns("onCreate"),this}_onEscapeKeyPressed(event){var key=UTILS.getCharKey(event),Box=$(".box").last().data("box");27===key&&Box&&Box.getId()===this.getId()&&this.clean()}set(data,skip){if(data&&_.isPlainObject(data)){for(var k in data)switch(!0){case/^target$/.test(k):var $target=this.getTarget();$(data[k]).get(0)!==$target.get(0)&&(this.setTarget(data[k]),this.getTargetDOM().append(this.values.$elm));break;case/^w$/.test(k):this.values.w=data[k],this.values.$elm.width(this.values.w);break;case/^h$/.test(k):this.values.h=data[k],this.values.divs.$outer.height(_.isNumber(this.values.h)?this.values.h-20:this.values.h);break;case/^title$/.test(k):this.values.title=data[k],this.values.title.length?(this.values.divs.$mainbody.removeClass("margin-t0"),this.values.divs.$hd.html("<span>"+this.values.title+"</span>").show()):(this.values.divs.$mainbody.addClass("margin-t0"),this.values.divs.$hd.empty().hide());break;case/^html$/.test(k):var $mainbody=this.values.divs.$mainbody;this.values.html=data[k],$mainbody.velocity("fadeIn",{duration:500,begin:function(){var $sensor=$mainbody.find(".resize-sensor");$mainbody.html(this.values.html),$sensor.length&&$mainbody.append($sensor)}.bind(this),complete:function(){this.enableResizeSensor(),this.fns("onContentUpdate")}.bind(this)});break;case/^controls$/.test(k):if(this.values.controls=data[k],this.values.divs.$controls.html(this.values.controls),this.values.divs.$controls.html().length){this.values.divs.$controls.addClass("expressed"),this.values.divs.$mainbody.css({marginBottom:this.values.divs.$controls.height()});var $close_btn=this.values.divs.$controls.find(".box-controls-close");$close_btn.length&&$close_btn.on("click.clean.utils.box",this.clean.bind(this))}else this.values.divs.$controls.removeClass("expressed"),this.values.divs.$mainbody.css({marginBottom:0});break;case/^classname$/.test(k):this.values.classname=data[k],this.values.$elm.addClass(this.values.classname);break;case/^buttons$/.test(k):for(var button in _.isPlainObject(data[k])&&_.extend(this.values.buttons,data[k]),this.values.buttons)switch(button){case"close":this.values.buttons.close?this.values.divs.$cls.removeClass("hide"):this.values.divs.$cls.addClass("hide");break;case"maximize":this.values.buttons.maximize?this.values.divs.$maximize.removeClass("hide"):this.values.divs.$maximize.addClass("hide")}break;case/^dd$/.test(k):this.values.dd=data[k],this.values.dd?(this.values.divs.$hd.addClass("cursor-movable"),this.values.$elm.data("draggable")?this.values.$elm.draggable("enable"):this.values.$elm.draggable({handle:this.values.divs.$hd.get(0)})):(this.values.divs.$hd.removeClass("cursor-movable"),this.values.$elm.data("draggable")&&this.values.$elm.draggable("disable"));break;case/^coords$/.test(k):this.values.coords=data[k],this.values.coords&&_.isPlainObject(this.values.coords)?(null!=this.values.coords.left&&this.values.$elm.css({left:this.values.coords.left}),null!=this.values.coords.top&&this.values.$elm.css({top:this.values.coords.top})):this.values.coords=null;break;case/^freeze$/.test(k):this.values.freeze=data[k],this.values.freeze?this.set({h:this.values.divs.$outer.outerHeight()+20},"skip"):this.set({h:"auto"},"skip");break;case/^center$/.test(k):this.values.center=data[k],$(window).off("resize.center.utils.box",this.onCenter),this.values.center&&($(window).on("resize.center.utils.box",this.onCenter.bind(this)),this.onCenter(),this.addCallback("onContentHeightChange",this.onCenter.bind(this)));break;case/^blur$/.test(k):_.isPlainObject(data[k])&&(this.values.blur=_.extend(this.values.blur,data[k]));break;case/^dimmer$/.test(k):this.values.dimmer=!!data[k];break;case/^scrollable$/.test(k):this.values.scrollable=!!data[k];break;case/^onClose|onBeforeClose|onComplete|onShow|onStart|onBeforeStart|onHide|onMaximize|onMinimize|onBlur|onUnblur|onContentUpdate|onCancel$/.test(k):this.addCallback(k,data[k]);break;case/^resizeDims$/.test(k):if(this.values.resizeDims=data[k],$(window).off("resize.utils.box",this.onResize),null!=this.values.resizeDims){if($(window).on("resize.utils.box",this.onResize.bind(this)),_.isNumber(this.values.resizeDims))tmp=[this.values.resizeDims,this.values.resizeDims,this.values.resizeDims,this.values.resizeDims];else var tmp=this.values.resizeDims.split("x");this.values.resizeDims=[];for(var i=0;i<tmp.length;i++)this.values.resizeDims.push(parseInt(tmp[i]));this.onResize()}}skip||this.selfCorrect()}return this}getControls(){return this.values.divs.$controls}getMainbody(){return this.values.divs.$mainbody}getParentBox(){return this.values.$elm.parent().closest(".box")}};