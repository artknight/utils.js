if(void 0===all_chart_packages)var all_chart_packages=[];UTILS.Chart=class extends UTILS.Base{constructor(data){return super(data),_log(this.getObjectName()+" --\x3e instantiated!",this.getId(),this),_.isPlainObject(data)&&("type"in data&&this.setType(data.type),"options"in data&&this.setOptions(data.options),"data"in data&&this.setData(data.data),"onShow"in data&&this.addCallback("onShow",data.onShow),"onHide"in data&&this.addCallback("onHide",data.onHide)),this}getDefaults(){return{object:"utils.chart",version:"0.0.4",$elm:$('<div class="google-chart"></div>'),type:"bar",title:"",is_shown:!1,is_3D:!1,Chart:null,data:null,ajax:{type:"GET",url:"/v1/chart/BidStatus/{type}",params:{}},mappings:{area:{method:"AreaChart",package:["corechart"],options:{width:300,height:125,colors:["#666666","#b90500","#b90500","#c01d19","#c73632","#ce504c","#d56966","#dc827f","#e39b99","#eab4b2","#f1cdcc","#f8e6e5"]}},pie:{method:"PieChart",package:["corechart"],options:{width:300,height:125,slices:{}}},line:{method:"LineChart",package:["line","corechart"],options:{width:300,height:125,colors:[]}},gauge:{method:"Gauge",package:["gauge"],options:{width:300,height:125}},bar:{method:"BarChart",package:["corechart"],options:{width:300,height:125,colors:[],hAxis:{minValue:0},vAxis:{title:""}}},column:{method:"ColumnChart",package:["corechart"],options:{width:300,height:125,colors:[]}},donut:{method:"PieChart",package:["corechart"],options:{width:300,height:125,pieHole:.5,slices:{}}}}}}getColors(){var colors=["#b10c00","#3f403f","#3f5765","#bdd4de","#efefef","#ce504c","#d56966","#dc827f","#e39b99","#eab4b2","#f1cdcc","#f8e6e5"];if(_.isIn(["donut","pie"],this.getType())){var _colors={};return _.each(colors,function(color,i){_colors[i]={color:color}}),{slices:_colors}}return{colors:colors}}clean(){return this.values.$elm.remove(),this}getType(){return this.values.type}setType(type){return/^pie3D$/i.test(type)?(this.values.type="pie",this.set3D(!0)):this.values.type=type,this}getTitle(){return this.values.title}is3D(){return this.values.is_3D}set3D(state){return this.values.is_3D=!!state,this}setTitle(title){return this.values.title=title,this}setTarget(target){return super.setTarget(target),this.values.$target.data("$chart",this),this}getPackagesToLoad(){var packages=this.getMapping().package,packages_not_loaded=[];return _.each(packages,function(_package){this.isPackageLoaded(_package)||(all_chart_packages.push(_package),packages_not_loaded.push(_package))}.bind(this)),packages_not_loaded}isPackageLoaded(_package){return _.isIn(all_chart_packages,_package)}getData(){return new Promise(function(resolve,reject){var $target=this.getTarget(),spinner=new UTILS.Spinner({target:$target,type:"small"}),ajax_settings=this.getAjaxData(),data={url:ajax_settings.url.replace(/\{type\}/,this.getType()),type:ajax_settings.type,data:{}};spinner.show(),$.ajax(data).done(function(response){spinner.hide(),resolve(response)}).fail(function(response){spinner.hide(),reject(Error("app.chart --\x3e network error"))})}.bind(this))}getOptions(){return this.getMapping().options}setOptions(options){return _.isPlainObject(options)&&("is3D"in options&&(this.set3D(options.is3D),delete options.is3D),_.extend(this.getOptions(),options)),this}getChartElm(){return this.values.$elm}getChart(){return this.values.Chart}setChart(Chart){return this.values.Chart=Chart,this}show(){return this.isShown()||(this.values.is_shown=!0,this._fns("onShow"),this._drawChart()),this}hide(){return this.values.is_shown=!1,this._fns("onHide"),this}isShown(){return this.values.is_shown}getMapping(){return this.values.mappings[this.getType()]}_drawChart(){var $chart=this.getChartElm(),mapping=this.getMapping(),title=this.getTitle(),options=this.getOptions(),is_3D=this.is3D(),packages_to_load=this.getPackagesToLoad(),load_timeout=null,load_timeout_count=0;title.length&&_.extend(options,{title:title}),is_3D&&_.extend(options,{is3D:is_3D}),_.extend(options,this.getColors()),this.getData().then(function(chart_data){var _draw=function(){new Promise(function(resolve,reject){try{var Chart=new google.visualization[mapping.method]($chart[0]),data=new google.visualization.arrayToDataTable(chart_data);console.log("app.chart --\x3e loaded google lib",mapping.method),clearTimeout(load_timeout),resolve({Chart:Chart,data:data})}catch(e){load_timeout_count<5?(load_timeout_count++,console.log("app.chart --\x3e running timeout ("+load_timeout_count+" times)",mapping.method),load_timeout=setTimeout(_draw,500)):reject()}}).then(function(response){this.setChart(response.Chart),response.Chart.draw(response.data,options)}.bind(this),function(){console.log("app.chart --\x3e could not load",mapping.method)})}.bind(this);this.getTarget().append($chart),packages_to_load.length&&google.charts.load("current",{packages:[packages_to_load.join()]}),google.charts.setOnLoadCallback(_draw)}.bind(this))}},"undefined"!=typeof module&&module.hasOwnProperty("exports")&&(module.exports=UTILS.Chart);