UTILS.Scroll=class extends UTILS.Base{init(data){return this.parent(data),_log("iscroll --\x3e instantiated!",this.IdToString(),this),_.isPlainObject(data)&&("scroll"in data&&this.setScroll(data.scroll),"start"in data&&this.setStart(data.start),"perpage"in data&&this.setPerPage(data.perpage),"bottom_padding"in data&&this.setBottomPadding(data.bottom_padding),"params"in data&&this.setParams(data.params),"onEnabled"in data&&this.addCallback("onEnabled",data.onEnabled),"onShowMoreLink"in data&&this.addCallback("onShowMoreLink",data.onShowMoreLink),"onHideMoreLink"in data&&this.addCallback("onHideMoreLink",data.onHideMoreLink),"onLoaded"in data&&this.setOnLoadedMethod(data.onLoaded),"onLoadedComplete"in data&&this.addCallback("onLoadedComplete",data.onLoadedComplete),"onLoadedSuccess"in data&&this.addCallback("onLoadedSuccess",data.onLoadedSuccess)),this}getDefaults(){return{version:"0.0.8",$scroll:$(window),start:0,per_page:50,bottom_padding:100,is_enabled:!1,is_fetchable:!0,format:"/{start}/{perpage}",is_window:!1,$spinner:null,$more:null,is_auto_load:!1,auto_timer:null,onloaded_method:null,params:{}}}setTarget(target){return this.parent(target),this.createSpinner(),this.createMoreLink(),this}getScroll(){return this.values.$scroll}setScroll(scroll){return this.values.$scroll=$(scroll),this.values.is_window=this.isWindow(),this}setOnLoadedMethod(method){return _.isFunction(method)&&(_log("iscroll --\x3e onLoaded method added"),this.values.onloaded_method=method),this}isFetchable(){return this.values.is_fetchable}isEnabled(){return this.values.is_enabled}isWindow(){return $.isWindow(this.getScroll()[0])}_observe(event){var $scroll=this.getScroll(),padding=this.getBottomPadding();this.isFetchable()&&(this.values.is_window&&$scroll.scrollTop()+$scroll.height()>=$(document).height()-padding||!this.values.is_window&&$scroll.prop("scrollHeight")-$scroll.scrollTop()===$scroll.outerHeight())&&(this.load(),this.setFetchableState(!1))}enable(){this.values.is_enabled||(_log("iscroll --\x3e enabled",this.getId()),this.getScroll().on("scroll",this._observe.bind(this)),this._fns("onEnabled"),this.values.is_enabled=!0);return this}disable(){return this.values.is_enabled&&(_log("iscroll --\x3e disabled",this.getId()),this.getTarget().off("scroll"),this.values.is_enabled=!1),this}setFetchableState(state){return this.values.is_fetchable=!!state,this}getFormat(){return this.values.format}setFormat(format){return this.values.format=format,this}getBottomPadding(){return this.values.bottom_padding}setBottomPadding(bottom_padding){return this.values.bottom_padding=bottom_padding,this}getPerPage(){return this.values.per_page}setPerPage(per_page){return _log("iscroll --\x3e per page number changed to "+per_page),this.values.per_page=per_page,this}getStart(){return this.values.start}setStart(start){return _log("iscroll --\x3e start number changed to "+start),this.values.start=start,this}getAjaxData(){var ajax=_.clone(this.parent()),start=this.getStart(),perpage=this.getPerPage(),pagination=this.getFormat().replace(/\{start\}/,start).replace(/\{perpage\}/,perpage);if(/\?/.test(ajax.url)){var _url=ajax.url.split("?");ajax.url=_url[0]+pagination+"?"+_url[1]}else ajax.url+=pagination;return ajax.params=this.getParams(),ajax}setAjaxData(ajax){return"url"in ajax&&/\/$/.test(ajax.url)&&(ajax.url=ajax.url.slice(0,-1)),"params"in ajax&&this.setParams(ajax.params),this.parent(ajax),this}getParams(){return _.extend({},_.isFunction(this.values.params)?this.values.params.call(null,this):this.values.params)}setParams(params){return params&&(this.values.params=params),this}createSpinner(){this.getTarget();var $wrapper=null,$spinner=$('<div class="iscroll-spinner" role="spinner"><div class="x-spinner"></div></div>');return this.isTargetTable()?($wrapper=$('<tr><td colspan="100"></td></tr>')).find("td").append($spinner):$wrapper=$spinner,this.values.$spinner=$wrapper,this}getSpinner(){return this.values.$spinner}showSpinner(){return this.getTarget().append(this.getSpinner()),this}hideSpinner(){return this.getSpinner().remove(),this}isTargetTable(){return/TABLE|TBODY/.test(this.getTarget()[0].tagName)}createMoreLink(){this.getTarget();var $wrapper=null,$more=$('<div class="text-center"><a class="iscroll-link show-all" href="#"><i class="fa fa-eye"></i> '+T.getMap("query::show all")+'</a><a class="iscroll-link show-more" href="#"><i class="fa fa-arrow-right"></i> '+T.getMap("query::more")+"</a></div>");return this.isTargetTable()?($wrapper=$('<tr><td colspan="100"></td></tr>')).find("td").append($more):$wrapper=$more,this.values.$more=$wrapper,this}disableMoreLink(){return this.hideMoreLink(),this.values.$more=null,this}getMoreLink(){return this.values.$more}isAutoLoad(){return this.values.is_auto_load}setAutoLoadState(state){return this.values.is_auto_load=!!state,this}showMoreLink(){var $scroll=this.isWindow()?$(document).contents().find("body"):this.getScroll(),$more=this.getMoreLink();return $more.length&&$scroll.prop("scrollHeight")===$scroll.prop("clientHeight")&&(this.getTarget().append($more),$more.find("a.show-all").on("click",function(event){event.preventDefault(),this.setPerPage(100).setAutoLoadState(!0).load()}.bind(this)),$more.find("a.show-more").on("click",function(event){event.preventDefault(),this.load()}.bind(this)),this._fns("onShowMoreLink")),this}hideMoreLink(){return this.getMoreLink().remove(),this._fns("onHideMoreLink"),this}_scrollToBottom(){return $("html, body").animate({scrollTop:$(document).height()}),this}_onLoaded(response){if(this._fns("onLoadedSuccess"),_.isFunction(this.values.onloaded_method))this.values.onloaded_method(response,this);else{var $target=this.getTarget(),items=JSON.parse(response).data;items.length?_.each(items,function(item){$target.append('<p class="app-item"><span class="name"><b>'+item.NAME+'</b></span><span class="desc">'+item.LONGDESCR+"</span></p>")}):($target.append('<p class="text-center">No results found.</p>'),this.setFetchableState(!1),this.setAutoLoadState(!1)),$total.text("Found "+$target.find(".app-item").length+" results")}return this}_onLoadedSuccess(response){this._fns("onLoadedComplete"),this.hideSpinner(),this.setFetchableState(!0),this._onLoaded(response),this.showMoreLink(),this.setStart(this.getStart()+this.getPerPage()),this.isAutoLoad()&&(this.values.auto_timer=setTimeout(this.load.bind(this),500))}_onLoadedError(response){this._fns("onLoadedComplete"),showJsError(response.responseJSON.error),this.hideSpinner(),this.showMoreLink(),this.setFetchableState(!1),this.setAutoLoadState(!1)}load(){if(this.isFetchable()){var ajax=this.getAjaxData();this.showSpinner(),this.hideMoreLink(),/GET/i.test(ajax.type)?$.getJSON(ajax.url).done(this._onLoadedSuccess).fail(this._onLoadedError):/POST/i.test(ajax.type)&&$.postJSON("POST",ajax.url,JSON.stringify(ajax.params),this._onLoadedSuccess,this._onLoadedError)}else clearTimeout(this.values.auto_timer),this.hideMoreLink();return this}},"undefined"!=typeof module&&module.hasOwnProperty("exports")&&(module.exports=UTILS.Scroll);