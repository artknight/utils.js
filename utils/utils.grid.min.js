UTILS.Grid=class extends UTILS.Base{constructor(data){return super(data),_log(this.getObjectName()+" --\x3e instantiated!",this.getId(),this),_.isPlainObject(data)&&("items"in data&&this.setItems(data.items),"width"in data&&this.setGridWidth(data.width),"onChange"in data&&this.addCallback("onChange",data.onChange),"onStateChange"in data&&this.addCallback("onStateChange",data.onStateChange),"onShow"in data&&this.addCallback("onShow",data.onShow),"onRenderedGridForPresentation"in data&&this.addCallback("onRenderedGridForPresentation",data.onRenderedGridForPresentation),"onEnableEditing"in data&&this.addCallback("onEnableEditing",data.onEnableEditing),"onDisableEditing"in data&&this.addCallback("onDisableEditing",data.onDisableEditing),"presentation"in data&&data.presentation&&this.setPresentationMode(data.presentation),"collapse"in data&&data.collapse&&this.enableCollapse()),this}getDefaults(){return{object:"utils.grid",version:"1.0.8",Grid:null,$items:[],$target:$("body"),grid_width:12,grid_cell_height:80,is_editable:!0,is_presentation:!1,is_collapse:!1,divs:{$grid:null,cells:[]}}}isCollapsable(){return this.values.is_collapse}enableCollapse(){return _log(this.getObjectName()+" --\x3e collapse setting enabled",this.getId()),this.values.is_collapse=!0,this}disableCollapse(){return _log(this.getObjectName()+" --\x3e collapse setting disabled",this.getId()),this.values.is_collapse=!1,this}isPresentationMode(){return this.values.is_presentation}setPresentationMode(state){return _log(this.getObjectName()+" --\x3e mode changed to "+(state?"presentation":"editable"),this.getId()),this.values.is_presentation=state,this}_getGridCellHeight(){return this.values.grid_cell_height}_setGridCellHeight(height){return _log(this.getObjectName()+" --\x3e cell height changed to "+height,this.getId()),this.values.grid_cell_height=height,this}getGridWidth(){return this.values.grid_width}setGridWidth(width){return this.values.grid_width=width,this._adjustGridCellsToWidth(),_log(this.getObjectName()+" --\x3e width changed to "+width,this.getId()),this}getGridHeight(){return Math.max.apply(null,_.map(this.getItems(),function(item){var data=$(item).data("grid");return data.y+data.width}))}getItems(){return this.values.$items}setItems(items){return this.values.$items=$(items),this}_getCells(){return this.values.divs.cells}getGrid(){return this.values.divs.$grid}_getGridElm(){return this.values.Grid}_setGridElm(Grid){return this.values.Grid=Grid,this}_adjustGridCellsToWidth(){return _.each(this._getCells(),function($cell){this._setCellClass($cell)}.bind(this)),this.updatePlaceholderClass(),this}_updatePlaceholderClass(){var $placeholder=this.getGrid().find(".grid-stack-placeholder");return this._setCellClass($placeholder),this}_getCellClass(){var grid_width=this.getGridWidth();return"grid-cell"+(grid_width?"-"+grid_width:"")}_setCellClass($cell){if($cell.length){var grid_width=this.getGridWidth(),classes=$cell.attr("class").match(/(?:^|)grid-cell-(\w+)(?!\w)/g)||[];classes.length&&$cell.removeClass(_.joinArray(classes," ")),$cell.addClass("grid-cell-"+grid_width)}return this}_createCell($item){var $cell=null,cell_class=this._getCellClass(),data=$item.data("grid");$cell=$('<div class="grid-stack-item '+cell_class+'" data-gs-x="'+data.x+'" data-gs-y="'+data.y+'" data-gs-width="'+data.width+'" data-gs-height="'+data.height+'"></div>').append($('<div class="grid-stack-item-content"></div>').append($item));return"min_width"in data&&$cell.attr("data-gs-min-width",data.min_width),"min_height"in data&&$cell.attr("data-gs-min-height",data.min_height),"max_width"in data&&$cell.attr("data-gs-max-width",data.max_width),"max_height"in data&&$cell.attr("data-gs-max-height",data.max_height),$cell}_addCellToGrid($cell){return this.values.divs.cells.push($cell),this.getGrid().append($cell),this}_loadItemsIntoCells(){var items=this.getItems();return items.length&&_.each(items,function(item){var $item=$(item),$cell=this._createCell($item);this._addCellToGrid($cell)}.bind(this)),this}_createGrid(){var items=this.getItems();return this.values.divs.$grid=$('<div class="grid-stack hide '+(this.isPresentationMode()?"grid-presentation":"")+'"></div>').data("app-gridstack",this),this.getTarget().prepend(this.values.divs.$grid),this.isPresentationMode()||(items.length&&this._loadItemsIntoCells(),this._initGridstack()),this.values.divs.$grid}_initGridstack(){var $grid=this.getGrid();return $grid.gridstack({cellHeight:this._getGridCellHeight(),verticalMargin:10,alwaysShowResizeHandle:/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent),draggable:{scroll:!0},resizable:{handles:"e, se, s, sw, w"}}).on("change",this.onGridChange.bind(this)),this._updatePlaceholderClass(),this._setGridElm($grid.data("gridstack")),this.fns("onCreate"),this}_unloadGridstack(){var $grid=this.getGrid();return _.each(this.getItems(),function(item){$grid.append($(item))}),$grid.data("gridstack",null),$grid.find(".grid-stack-item").remove(),this}_getCellFromItem($item){return $item.closest(".grid-stack-item")}getNextPosition(width,height,min_width,max_height){var GridElm=this._getGridElm(),$widget=GridElm.addWidget($('<div class="hide"></div>'),0,0,width||1,height||1,!0,min_width||1,null,max_height||1,null),data=this._getCellPosition($widget);return GridElm.removeWidget($widget),{x:data.x,y:data.y,width:data.width,height:data.height,min_width:data.minWidth,min_height:data.minHeight}}showHiddenItem($item){return!$item.hasClass("grid-field")&&($item=$item.closest(".grid-field")),$item.length&&$item.hasClass("grid-field-hidden")&&(_log(this.getObjectName()+" --\x3e item state changed to show",$item),$item.removeClass("grid-field-hidden"),this.isPresentationMode()?this.reload():(this._getCellFromItem($item).show(),this.isCollapsable()&&this.reload())),this}hideShownItem($item){return!$item.hasClass("grid-field")&&($item=$item.closest(".grid-field")),$item.length&&!$item.hasClass("grid-field-hidden")&&(_log(this.getObjectName()+" --\x3e item state changed to hide",$item),$item.addClass("grid-field-hidden"),this.isPresentationMode()?this.reload():(this._getCellFromItem($item).hide(),this.isCollapsable()&&this.reload())),this}getCellContent($cell){return $cell.find(".grid-stack-item-content")}setGridState(state){return this.values.is_editable=state,this.fns("onStateChange",{state:state}),this}_enableEditing(){var GridElm=this._getGridElm();return GridElm&&(GridElm.setStatic(!1),GridElm.cellHeight(this._getGridCellHeight())),this.getGrid().addClass("editable"),this.getTarget().addClass("editable"),this.fns("onEnableEditing"),this}_disableEditing(){var GridElm=this._getGridElm();return GridElm&&(GridElm.setStatic(!0),GridElm.cellHeight(this._getGridCellHeight())),this.getGrid().removeClass("editable"),this.getTarget().removeClass("editable"),this.fns("onDisableEditing"),this}hide(){return this.getGrid().addClass("hide"),this.fns("onHide"),this}show(){return this._createGrid().removeClass("hide"),this.isPresentationMode()?(this._disableEditing(),this._renderGridForPresentation()):this._enableEditing(),this.fns("onShow"),this}reload(){var GridElm=this._getGridElm(),$grid=this.getGrid();_log(this.getObjectName()+" --\x3e reloading...",this.getId());var $tmp_container=$('<div class="hide"></div>');return $("body").append($tmp_container),_.each(this.getItems(),function(item){$tmp_container.append($(item))}),GridElm&&(GridElm.removeAll(),this.values.divs.cells=[]),$grid&&$grid.remove(),this.show(),$tmp_container.remove(),this}onGridChange(){this._udpateItemsPosition().fns("onChange")}_udpateItemsPosition(){return this.isPresentationMode()||_.each(this._getCells(),function($cell){var $item=$cell.find(".grid-field"),item_grid_data=$item.data("grid"),data=this._getCellPosition($cell);$item.data("grid",_.extend(item_grid_data,{x:data.x,y:data.y,width:data.width,height:data.height}))}.bind(this)),this}_getCellPosition($cell){return $cell.data("_gridstack_node")}_renderGridForPresentation(){_log(this.getObjectName()+" --\x3e CA --\x3e rendering cells for presentation",this.getId());var $grid=this.getGrid(),items=this.getItems(),cell_height=this._getGridCellHeight(),is_collapsable=this.isCollapsable();this._unloadGridstack(),$("head").append("<style> @media (min-width: 768px) { .grid-row { height:"+cell_height+"px; } } </style>");var normalized_items=_.map(items,function(item){var $item=$(item),item_data=$item.data("grid");return{x:parseInt(item_data.x)+1,y:parseInt(item_data.y)+1,width:parseInt(item_data.width),height:parseInt(item_data.height),$item:$item}});normalized_items=_.sortBy(normalized_items,function(item){return item.x});var rows,grouped_items,max_row;if(rows=[],grouped_items=_.groupBy(normalized_items,function(item){return item.y}),max_row=_.max(normalized_items,function(item){return item.y}).y,_.times(max_row,function(n){var $row;rows.push({y:n,$row:($row=$('<div class="row col-sm-12 grid-row"></div>'),!is_collapsable&&$row.css("min-height",cell_height),$row)})}),_.each(grouped_items,function(items,row){var $row=rows[row-1].$row;_.each(items,function(item,index,items_in_row){var immediate_left_item=items_in_row[index-1],$wrapper=function(item,offset){var $wrapper=$('<div class="grid-item-wrapper"></div>');return $wrapper.data("item-data",item),$wrapper.attr("data-x",item.x).attr("data-y",item.y).attr("data-width",item.width).attr("data-height",item.height),$wrapper.addClass("col-sm-"+item.width),offset>0&&$wrapper.addClass("col-sm-offset-"+offset),!is_collapsable&&$wrapper.css("height",item.height*cell_height),$wrapper.append(item.$item),$wrapper}(item,immediate_left_item?item.x-(immediate_left_item.x+immediate_left_item.width):item.x-1);$row.append($wrapper),item.$item.hasClass("grid-field-hidden")&&$wrapper.hide()})}),_.each(rows,function(row){$grid.append(row.$row)}),is_collapsable){_log(this.getObjectName()+" --\x3e CA --\x3e removing empty rows");var empty_rows=_.filter($(".grid-row"),function(row){return $(row).is(":empty")});$(empty_rows).remove()}return this.fns("onRenderedGridForPresentation"),this}};